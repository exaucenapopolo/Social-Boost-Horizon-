<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Communauté - Social Boost Horizon</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Montserrat:wght@600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

  <style>
    :root {
      --sbh-dark-blue: #0A162B;
      --sbh-gradient-start: #1e3c72;
      --sbh-gradient-end: #6a0dad;
      --sbh-btn-color: #1E90FF;
      --sbh-icon-color: #4CAF50;
      --sbh-text-white: #FFFFFF;
      --sbh-light-blue: #4DA6FF;
      --sbh-accent: #FF6B6B;
      --success-green: #4CAF50;
      --error-red: #f44336;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Poppins', sans-serif;
      color: var(--sbh-text-white);
      background: var(--sbh-dark-blue);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      overflow-x: hidden;
    }

    .background-animation {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      z-index: -1;
      background: linear-gradient(135deg, var(--sbh-dark-blue) 0%, #0f2744 50%, #1a1a3e 100%);
      overflow: hidden;
    }

    .background-animation::before {
      content: "";
      position: absolute;
      width: 2px; height: 2px;
      border-radius: 50%;
      background: white;
      box-shadow: 100px 50px white, 200px 150px white, 300px 250px white,
        400px 70px white, 50px 300px white, 500px 400px white, 600px 120px white,
        700px 350px white, 80px 10px white, 420px 220px white, 680px 50px white,
        150px 450px white, 550px 320px white;
      animation: twinkle 5s infinite alternate;
    }

    @keyframes twinkle {
      0%, 100% { opacity: 0.3; transform: scale(1); }
      50% { opacity: 0.8; transform: scale(1.1); }
    }

    header {
      position: sticky;
      top: 0;
      background: linear-gradient(45deg, var(--sbh-gradient-start), var(--sbh-gradient-end));
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 2rem;
      z-index: 100;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    }

    .logo-text {
      display: flex;
      flex-direction: column;
      text-decoration: none;
      line-height: 1.2;
    }

    .logo-text .text-social,
    .logo-text .text-horizon {
      color: var(--sbh-text-white);
      font-size: 1.2rem;
      font-weight: 600;
    }

    .logo-text .boost-line {
      display: flex;
      align-items: center;
      color: var(--sbh-icon-color);
      font-size: 1.6rem;
      font-weight: 800;
    }

    .logo-text .boost-line i {
      margin-right: 6px;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }

    .hamburger-btn {
      font-size: 1.8rem;
      color: var(--sbh-text-white);
      cursor: pointer;
      transition: transform 0.3s;
      background: none;
      border: none;
    }

    .hamburger-btn:hover { transform: scale(1.1); }

    .mobile-menu {
      display: none;
      position: absolute;
      top: 68px;
      right: 2rem;
      background: rgba(10, 22, 43, 0.98);
      border: 1px solid rgba(255, 255, 255, 0.15);
      border-radius: 12px;
      padding: 1.5rem;
      flex-direction: column;
      z-index: 200;
      min-width: 260px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
    }

    header.open .mobile-menu { display: flex; }

    .mobile-menu a {
      color: var(--sbh-text-white);
      text-decoration: none;
      padding: 0.8rem 1rem;
      font-weight: 500;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
    }

    .mobile-menu a:last-child { border-bottom: none; }
    .mobile-menu a i { margin-right: 12px; color: var(--sbh-light-blue); width: 24px; }
    .mobile-menu a:hover { background: rgba(30, 60, 114, 0.4); border-radius: 8px; transform: translateX(5px); }

    .main-container {
      max-width: 800px;
      margin: 30px auto;
      padding: 0 20px;
      flex: 1;
      width: 100%;
    }

    /* Publication */
    .create-post {
      background: linear-gradient(145deg, rgba(20, 35, 65, 0.8), rgba(15, 25, 50, 0.9));
      border: 1px solid rgba(255, 255, 255, 0.12);
      border-radius: 20px;
      padding: 20px;
      margin-bottom: 30px;
      backdrop-filter: blur(10px);
      position: relative;
      overflow: hidden;
    }

    .create-post::before {
      content: "";
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 5px;
      background: linear-gradient(90deg, var(--sbh-gradient-start), var(--sbh-gradient-end), var(--sbh-icon-color));
    }

    .post-header {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 15px;
    }

    .post-avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--sbh-gradient-start), var(--sbh-gradient-end));
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      font-weight: 600;
      color: white;
      overflow: hidden;
      border: 2px solid rgba(255, 255, 255, 0.2);
    }

    .post-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .post-input {
      flex: 1;
      background: rgba(0, 0, 0, 0.3);
      border: 2px solid rgba(255, 255, 255, 0.15);
      border-radius: 30px;
      padding: 12px 20px;
      color: white;
      font-size: 1rem;
      transition: all 0.3s;
    }

    .post-input:focus {
      border-color: var(--sbh-btn-color);
      outline: none;
      box-shadow: 0 0 0 3px rgba(30, 144, 255, 0.2);
    }

    .post-actions {
      display: flex;
      justify-content: flex-end;
      gap: 15px;
      margin-top: 15px;
    }

    .btn-post {
      background: linear-gradient(45deg, var(--sbh-gradient-start), var(--sbh-btn-color));
      color: white;
      border: none;
      padding: 10px 30px;
      border-radius: 50px;
      font-weight: 600;
      cursor: pointer;
      transition: 0.3s;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .btn-post:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 20px rgba(30, 144, 255, 0.4);
    }

    /* Posts list */
    .posts-list {
      display: flex;
      flex-direction: column;
      gap: 25px;
    }

    .post-card {
      background: linear-gradient(145deg, rgba(20, 35, 65, 0.8), rgba(15, 25, 50, 0.9));
      border: 1px solid rgba(255, 255, 255, 0.12);
      border-radius: 20px;
      padding: 20px;
      backdrop-filter: blur(10px);
      transition: 0.3s;
    }

    .post-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
    }

    .post-card-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 15px;
    }

    .post-author-avatar {
      width: 45px;
      height: 45px;
      border-radius: 50%;
      overflow: hidden;
      border: 2px solid rgba(255, 255, 255, 0.2);
      background: linear-gradient(135deg, var(--sbh-gradient-start), var(--sbh-gradient-end));
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      color: white;
    }

    .post-author-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .post-author-info {
      flex: 1;
    }

    .post-author-name {
      font-weight: 600;
      color: white;
    }

    .post-date {
      font-size: 0.8rem;
      color: rgba(255, 255, 255, 0.6);
    }

    .post-content {
      margin-bottom: 15px;
      line-height: 1.6;
      white-space: pre-wrap;
    }

    .post-stats {
      display: flex;
      gap: 20px;
      padding: 10px 0;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      margin-bottom: 15px;
    }

    .post-stat {
      display: flex;
      align-items: center;
      gap: 5px;
      color: rgba(255, 255, 255, 0.7);
      font-size: 0.9rem;
    }

    .post-stat i {
      font-size: 1.1rem;
    }

    .post-actions-bar {
      display: flex;
      gap: 15px;
    }

    .action-btn {
      background: none;
      border: none;
      color: rgba(255, 255, 255, 0.7);
      font-size: 1rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
      padding: 5px 10px;
      border-radius: 20px;
      transition: 0.3s;
    }

    .action-btn:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .action-btn.liked i {
      color: #ff4d4d;
    }

    .comments-section {
      margin-top: 20px;
      padding-top: 15px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }

    .comment {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
    }

    .comment-avatar {
      width: 35px;
      height: 35px;
      border-radius: 50%;
      overflow: hidden;
      background: linear-gradient(135deg, var(--sbh-gradient-start), var(--sbh-gradient-end));
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      color: white;
      flex-shrink: 0;
    }

    .comment-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .comment-content {
      background: rgba(255, 255, 255, 0.05);
      padding: 10px 15px;
      border-radius: 18px;
      flex: 1;
    }

    .comment-author {
      font-weight: 600;
      font-size: 0.9rem;
      margin-bottom: 3px;
    }

    .comment-text {
      font-size: 0.9rem;
      color: rgba(255, 255, 255, 0.9);
    }

    .comment-input-area {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }

    .comment-input {
      flex: 1;
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 25px;
      padding: 10px 15px;
      color: white;
    }

    .comment-input:focus {
      outline: none;
      border-color: var(--sbh-btn-color);
    }

    .btn-comment {
      background: linear-gradient(45deg, var(--sbh-gradient-start), var(--sbh-btn-color));
      border: none;
      color: white;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
      transition: 0.3s;
    }

    .btn-comment:hover {
      transform: scale(1.1);
    }

    /* Section communautés externes */
    .external-communities {
      margin-top: 50px;
      padding: 30px;
      background: linear-gradient(145deg, rgba(20, 35, 65, 0.8), rgba(15, 25, 50, 0.9));
      border-radius: 25px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.12);
      position: relative;
      overflow: hidden;
    }

    .external-communities::before {
      content: "";
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 5px;
      background: linear-gradient(90deg, var(--sbh-gradient-start), var(--sbh-gradient-end), var(--sbh-icon-color));
    }

    .section-title {
      font-size: 1.8rem;
      font-weight: 700;
      margin-bottom: 25px;
      display: flex;
      align-items: center;
      gap: 10px;
      color: var(--sbh-light-blue);
    }

    .communities-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
    }

    .community-card {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 15px;
      padding: 20px;
      text-align: center;
      border: 1px solid rgba(255, 255, 255, 0.1);
      transition: 0.3s;
    }

    .community-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
      border-color: var(--sbh-light-blue);
    }

    .community-icon {
      width: 70px;
      height: 70px;
      margin: 0 auto 15px;
      background: linear-gradient(135deg, var(--sbh-gradient-start), var(--sbh-gradient-end));
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.5rem;
      color: white;
    }

    .community-name {
      font-weight: 600;
      font-size: 1.2rem;
      margin-bottom: 5px;
    }

    .community-desc {
      color: rgba(255, 255, 255, 0.7);
      font-size: 0.9rem;
      margin-bottom: 15px;
    }

    .community-btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: linear-gradient(45deg, #25D366, #128C7E);
      color: white;
      padding: 10px 25px;
      border-radius: 50px;
      text-decoration: none;
      font-weight: 600;
      transition: 0.3s;
    }

    .community-btn.whatsapp-channel {
      background: linear-gradient(45deg, #25D366, #075E54);
    }

    .community-btn.facebook {
      background: linear-gradient(45deg, #1877F2, #0E5A9E);
    }

    .community-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }

    footer {
      background: linear-gradient(to right, var(--sbh-gradient-start), var(--sbh-gradient-end));
      color: var(--sbh-text-white);
      padding: 2rem;
      text-align: center;
      margin-top: auto;
    }

    footer p {
      font-size: 0.9rem;
      opacity: 0.9;
    }

    .loading-overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(10, 22, 43, 0.9);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }

    .loading-overlay .spinner {
      width: 50px;
      height: 50px;
      border: 5px solid rgba(255,255,255,0.3);
      border-top-color: white;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin { to { transform: rotate(360deg); } }

    .notification-container {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 10000;
    }

    .notification {
      display: flex;
      align-items: center;
      padding: 18px 25px;
      border-radius: 15px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
      background: linear-gradient(135deg, rgba(20, 35, 65, 0.98), rgba(15, 25, 50, 0.98));
      border: 1px solid rgba(255, 255, 255, 0.1);
      color: white;
      font-weight: 500;
      max-width: 400px;
      transform: translateX(120%);
      animation: slideIn 0.5s forwards;
    }

    .notification.success {
      border-left: 5px solid var(--success-green);
    }

    .notification.error {
      border-left: 5px solid var(--error-red);
    }

    .notification-icon {
      font-size: 28px;
      margin-right: 15px;
    }

    .notification.success .notification-icon { color: var(--success-green); }
    .notification.error .notification-icon { color: var(--error-red); }

    @keyframes slideIn {
      to { transform: translateX(0); }
    }

    @media (max-width: 600px) {
      .main-container { padding: 0 15px; }
      .post-header { flex-direction: column; align-items: flex-start; }
      .post-actions { justify-content: center; }
      .communities-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="background-animation"></div>
  <div class="notification-container" id="notificationContainer"></div>
  
  <div class="loading-overlay" id="loadingOverlay">
    <div class="spinner"></div>
    <p>Chargement de la communauté...</p>
  </div>

  <header data-aos="fade-down">
    <a href="dashboard.html" class="logo-text">
      <span class="text-social">SOCIAL</span>
      <div class="boost-line">
        <i class="fa-solid fa-rocket"></i>
        <span class="text-boost">BOOST</span>
      </div>
      <span class="text-horizon">HORIZON</span>
    </a>
    <button class="hamburger-btn" id="hamburgerBtn" aria-label="Menu">
      <i class="fa-solid fa-bars"></i>
    </button>
    <div class="mobile-menu">
      <a href="dashboard.html"><i class="fa-solid fa-house"></i> Accueil</a>
      <a href="wallet.html"><i class="fa-solid fa-wallet"></i> Mon portefeuille</a>
      <a href="commander.html"><i class="fa-solid fa-shopping-cart"></i> Commander</a>
      <a href="commandes.html"><i class="fa-solid fa-list"></i> Mes commandes</a>
      <a href="parrainage.html"><i class="fa-solid fa-handshake"></i> Parrainage</a>
      <a href="fonds.html"><i class="fa-solid fa-money-bill"></i> Ajouter des fonds</a>
      <a href="profil.html"><i class="fa-solid fa-user"></i> Mon profil</a>
    </div>
  </header>

  <div class="main-container">
    <!-- Zone de création de post -->
    <div class="create-post" data-aos="fade-up">
      <div class="post-header">
        <div class="post-avatar" id="currentUserAvatar"></div>
        <input type="text" class="post-input" id="postContent" placeholder="Quoi de neuf ?">
      </div>
      <div class="post-actions">
        <button class="btn-post" id="publishPostBtn"><i class="fa-solid fa-paper-plane"></i> Publier</button>
      </div>
    </div>

    <!-- Liste des posts -->
    <div class="posts-list" id="postsList" data-aos="fade-up">
      <!-- Les posts seront injectés ici -->
    </div>

    <!-- Section Communautés externes -->
    <div class="external-communities" data-aos="fade-up">
      <h2 class="section-title"><i class="fa-solid fa-users"></i> Nos communautés externes</h2>
      <div class="communities-grid">
        <!-- WhatsApp Groupe Principal -->
        <div class="community-card">
          <div class="community-icon"><i class="fa-brands fa-whatsapp"></i></div>
          <div class="community-name">WhatsApp Groupe Principal</div>
          <div class="community-desc">Social Boost Horizon</div>
          <a href="https://chat.whatsapp.com/HRgWJFxTgkiEkEC0Ou2028?mode=gi_t" target="_blank" class="community-btn"><i class="fa-brands fa-whatsapp"></i> Rejoindre</a>
        </div>
        <!-- Canal WhatsApp Officiel -->
        <div class="community-card">
          <div class="community-icon"><i class="fa-brands fa-whatsapp"></i></div>
          <div class="community-name">Canal WhatsApp Officiel</div>
          <div class="community-desc">Annonces et infos</div>
          <a href="https://whatsapp.com/channel/0029Vb7A88V5q08c9iIrnP32" target="_blank" class="community-btn whatsapp-channel"><i class="fa-brands fa-whatsapp"></i> S'abonner</a>
        </div>
        <!-- Communauté WhatsApp -->
        <div class="community-card">
          <div class="community-icon"><i class="fa-brands fa-whatsapp"></i></div>
          <div class="community-name">Communauté WhatsApp</div>
          <div class="community-desc">Échanges et discussions</div>
          <a href="https://chat.whatsapp.com/K54dp5cfahY1JR0cwELzbC" target="_blank" class="community-btn"><i class="fa-brands fa-whatsapp"></i> Rejoindre</a>
        </div>
        <!-- Groupe Facebook -->
        <div class="community-card">
          <div class="community-icon"><i class="fa-brands fa-facebook"></i></div>
          <div class="community-name">Groupe Facebook</div>
          <div class="community-desc">Social Boost Horizon</div>
          <a href="https://www.facebook.com/groups/1358067869410552/?ref=share&mibextid=NSMWBT" target="_blank" class="community-btn facebook"><i class="fa-brands fa-facebook"></i> Rejoindre</a>
        </div>
      </div>
    </div>
  </div>

  <footer>
    <p>Social Boost Horizon - Tous droits réservés 2025</p>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

  <script>
    // Configuration Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyD2JiDS0g8EkeNXxjO7_wGI3WznpPvcCCk",
      authDomain: "social-boost-horizon.firebaseapp.com",
      projectId: "social-boost-horizon",
      storageBucket: "social-boost-horizon.appspot.com",
      messagingSenderId: "43658165639",
      appId: "1:43658165639:web:b8f492dc6a25cd12fc6722"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    let currentUser = null;
    let currentUserData = null;

    // Éléments DOM
    const loadingOverlay = document.getElementById('loadingOverlay');
    const postsList = document.getElementById('postsList');
    const postContent = document.getElementById('postContent');
    const publishBtn = document.getElementById('publishPostBtn');
    const currentUserAvatar = document.getElementById('currentUserAvatar');
    const notificationContainer = document.getElementById('notificationContainer');

    // Initialisation
    document.addEventListener('DOMContentLoaded', function() {
      AOS.init({ duration: 800, once: true });

      // Menu hamburger
      const header = document.querySelector('header');
      const hamburger = document.getElementById('hamburgerBtn');
      hamburger.addEventListener('click', () => header.classList.toggle('open'));
      document.addEventListener('click', (e) => {
        if (!header.contains(e.target) && header.classList.contains('open')) {
          header.classList.remove('open');
        }
      });

      // Auth state
      auth.onAuthStateChanged(async (user) => {
        if (!user) {
          window.location.href = 'login.html';
          return;
        }
        currentUser = user;
        await loadCurrentUserData();
        loadingOverlay.style.display = 'none';
        loadPosts();
      });

      // Publier un post
      publishBtn.addEventListener('click', publishPost);
    });

    // Charger les données de l'utilisateur courant
    async function loadCurrentUserData() {
      try {
        const doc = await db.collection('users').doc(currentUser.uid).get();
        if (doc.exists) {
          currentUserData = doc.data();
        } else {
          currentUserData = { displayName: currentUser.displayName || 'Utilisateur', photoURL: null };
        }
      } catch (err) {
        console.error('Erreur chargement user data:', err);
        currentUserData = { displayName: currentUser.displayName || 'Utilisateur', photoURL: null };
      }
      // Afficher avatar de l'utilisateur courant
      if (currentUserData.photoURL) {
        currentUserAvatar.innerHTML = `<img src="${currentUserData.photoURL}" alt="Avatar">`;
      } else {
        const initial = (currentUserData.displayName || 'U').charAt(0).toUpperCase();
        currentUserAvatar.textContent = initial;
      }
    }

    // Charger les posts
    function loadPosts() {
      db.collection('posts').orderBy('createdAt', 'desc').onSnapshot((snapshot) => {
        postsList.innerHTML = '';
        snapshot.forEach((doc) => {
          const post = doc.data();
          post.id = doc.id;
          renderPost(post);
        });
      }, (error) => {
        showNotification('Erreur de chargement des posts', false);
      });
    }

    // Rendu d'un post
    async function renderPost(post) {
      // Récupérer les infos de l'auteur
      let authorName = 'Utilisateur';
      let authorPhoto = null;
      try {
        const userDoc = await db.collection('users').doc(post.userId).get();
        if (userDoc.exists) {
          authorName = userDoc.data().displayName || 'Utilisateur';
          authorPhoto = userDoc.data().photoURL || null;
        }
      } catch (err) {
        console.error('Erreur auteur:', err);
      }

      const postDate = post.createdAt ? new Date(post.createdAt.seconds * 1000).toLocaleDateString('fr-FR', { day: 'numeric', month: 'short', year: 'numeric', hour: '2-digit', minute: '2-digit' }) : 'Date inconnue';

      const likesCount = post.likes ? post.likes.length : 0;
      const commentsCount = post.commentsCount || 0; // on pourrait compter en temps réel

      // Vérifier si l'utilisateur courant a liké
      const isLiked = post.likes && post.likes.includes(currentUser.uid);

      // Créer l'élément HTML
      const postElement = document.createElement('div');
      postElement.className = 'post-card';
      postElement.dataset.id = post.id;

      // En-tête
      let authorAvatarHtml = '';
      if (authorPhoto) {
        authorAvatarHtml = `<img src="${authorPhoto}" alt="Avatar">`;
      } else {
        authorAvatarHtml = authorName.charAt(0).toUpperCase();
      }

      postElement.innerHTML = `
        <div class="post-card-header">
          <div class="post-author-avatar">${authorAvatarHtml}</div>
          <div class="post-author-info">
            <div class="post-author-name">${authorName}</div>
            <div class="post-date">${postDate}</div>
          </div>
        </div>
        <div class="post-content">${post.content.replace(/\n/g, '<br>')}</div>
        <div class="post-stats">
          <div class="post-stat"><i class="fa-regular fa-heart"></i> ${likesCount} j'aime</div>
          <div class="post-stat"><i class="fa-regular fa-comment"></i> ${commentsCount} commentaires</div>
        </div>
        <div class="post-actions-bar">
          <button class="action-btn like-btn ${isLiked ? 'liked' : ''}"><i class="fa-${isLiked ? 'solid' : 'regular'} fa-heart"></i> J'aime</button>
          <button class="action-btn comment-toggle-btn"><i class="fa-regular fa-comment"></i> Commenter</button>
        </div>
        <div class="comments-section" style="display: none;">
          <div class="comments-list" id="comments-${post.id}"></div>
          <div class="comment-input-area">
            <input type="text" class="comment-input" placeholder="Écrire un commentaire...">
            <button class="btn-comment"><i class="fa-solid fa-paper-plane"></i></button>
          </div>
        </div>
      `;

      // Gestionnaires d'événements
      const likeBtn = postElement.querySelector('.like-btn');
      likeBtn.addEventListener('click', () => toggleLike(post.id, likeBtn));

      const commentToggle = postElement.querySelector('.comment-toggle-btn');
      const commentsSection = postElement.querySelector('.comments-section');
      commentToggle.addEventListener('click', () => {
        const isVisible = commentsSection.style.display === 'block';
        commentsSection.style.display = isVisible ? 'none' : 'block';
        if (!isVisible) {
          loadComments(post.id, postElement.querySelector('.comments-list'));
        }
      });

      const commentInput = postElement.querySelector('.comment-input');
      const commentBtn = postElement.querySelector('.btn-comment');
      commentBtn.addEventListener('click', () => {
        const text = commentInput.value.trim();
        if (text) {
          addComment(post.id, text, commentInput);
        }
      });

      postsList.appendChild(postElement);
    }

    // Fonction pour liker/unliker
    async function toggleLike(postId, likeBtn) {
      try {
        const postRef = db.collection('posts').doc(postId);
        await db.runTransaction(async (transaction) => {
          const postDoc = await transaction.get(postRef);
          if (!postDoc.exists) throw new Error('Post introuvable');
          const likes = postDoc.data().likes || [];
          const alreadyLiked = likes.includes(currentUser.uid);
          if (alreadyLiked) {
            // Unlike
            transaction.update(postRef, {
              likes: firebase.firestore.FieldValue.arrayRemove(currentUser.uid)
            });
          } else {
            // Like
            transaction.update(postRef, {
              likes: firebase.firestore.FieldValue.arrayUnion(currentUser.uid)
            });
          }
        });
        // Mise à jour UI
        const isLiked = likeBtn.classList.contains('liked');
        likeBtn.classList.toggle('liked', !isLiked);
        const icon = likeBtn.querySelector('i');
        icon.className = !isLiked ? 'fa-solid fa-heart' : 'fa-regular fa-heart';
        // Mettre à jour le compteur (pas nécessaire car on écoute en temps réel, mais on peut le faire)
      } catch (err) {
        showNotification('Erreur lors du like', false);
        console.error(err);
      }
    }

    // Charger les commentaires d'un post
    async function loadComments(postId, commentsListEl) {
      try {
        const snapshot = await db.collection('posts').doc(postId).collection('comments').orderBy('createdAt', 'asc').get();
        commentsListEl.innerHTML = '';
        for (const doc of snapshot.docs) {
          const comment = doc.data();
          // Récupérer l'auteur du commentaire
          let authorName = 'Utilisateur';
          let authorPhoto = null;
          try {
            const userDoc = await db.collection('users').doc(comment.userId).get();
            if (userDoc.exists) {
              authorName = userDoc.data().displayName || 'Utilisateur';
              authorPhoto = userDoc.data().photoURL || null;
            }
          } catch (err) {}
          const commentDate = comment.createdAt ? new Date(comment.createdAt.seconds * 1000).toLocaleDateString('fr-FR', { day: 'numeric', month: 'short', hour: '2-digit', minute: '2-digit' }) : '';
          const commentEl = document.createElement('div');
          commentEl.className = 'comment';
          let avatarHtml = '';
          if (authorPhoto) {
            avatarHtml = `<img src="${authorPhoto}" alt="Avatar">`;
          } else {
            avatarHtml = authorName.charAt(0).toUpperCase();
          }
          commentEl.innerHTML = `
            <div class="comment-avatar">${avatarHtml}</div>
            <div class="comment-content">
              <div class="comment-author">${authorName} <span style="font-size:0.7rem; color:rgba(255,255,255,0.5);">${commentDate}</span></div>
              <div class="comment-text">${comment.content}</div>
            </div>
          `;
          commentsListEl.appendChild(commentEl);
        }
      } catch (err) {
        console.error('Erreur chargement commentaires:', err);
      }
    }

    // Ajouter un commentaire
    async function addComment(postId, text, inputEl) {
      try {
        await db.collection('posts').doc(postId).collection('comments').add({
          userId: currentUser.uid,
          content: text,
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        // Mettre à jour le compteur de commentaires (optionnel)
        const postRef = db.collection('posts').doc(postId);
        await postRef.update({
          commentsCount: firebase.firestore.FieldValue.increment(1)
        });
        inputEl.value = '';
        showNotification('Commentaire ajouté', true);
      } catch (err) {
        showNotification('Erreur', false);
        console.error(err);
      }
    }

    // Publier un nouveau post
    async function publishPost() {
      const content = postContent.value.trim();
      if (!content) {
        showNotification('Veuillez écrire quelque chose', false);
        return;
      }
      try {
        await db.collection('posts').add({
          userId: currentUser.uid,
          content: content,
          createdAt: firebase.firestore.FieldValue.serverTimestamp(),
          likes: [],
          commentsCount: 0
        });
        postContent.value = '';
        showNotification('Post publié !', true);
      } catch (err) {
        showNotification('Erreur lors de la publication', false);
        console.error(err);
      }
    }

    // Afficher une notification
    function showNotification(message, isSuccess) {
      const notification = document.createElement('div');
      notification.className = `notification ${isSuccess ? 'success' : 'error'}`;
      notification.innerHTML = `
        <div class="notification-icon">${isSuccess ? '<i class="fa-solid fa-check-circle"></i>' : '<i class="fa-solid fa-times-circle"></i>'}</div>
        <div class="notification-text">${message}</div>
      `;
      notificationContainer.appendChild(notification);
      setTimeout(() => {
        notification.style.animation = 'slideIn 0.5s reverse forwards';
        setTimeout(() => notification.remove(), 500);
      }, 4000);
    }
  </script>
</body>
</html>