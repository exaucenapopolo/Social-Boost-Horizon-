<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Communauté - Social Boost Horizon</title>

  <!-- Firebase SDK : app + auth + database -->
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

  <!-- Fonts & Icons -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

  <!-- AOS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css">

  <style>
    /* ========== VARIABLES & DESIGN SYSTEM ========== */
    :root {
      --primary-color: #1A237E;
      --secondary-color: #283593;
      --accent-color: #00BFA5;
      --accent-dark: #00897B;
      --warning-color: #FF6B35;
      --success-color: #4CAF50;
      --text-primary: #FFFFFF;
      --text-secondary: #B0BEC5;
      --text-tertiary: #78909C;
      --bg-primary: #0F1A30;
      --bg-secondary: #1A2B4A;
      --bg-tertiary: #25395A;
      --card-bg: rgba(255, 255, 255, 0.05);
      --border-color: rgba(255, 255, 255, 0.1);
      --shadow-lg: 0 20px 60px rgba(0, 0, 0, 0.3);
      --shadow-md: 0 10px 40px rgba(0, 0, 0, 0.2);
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 20px;
      --radius-xl: 30px;
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html {
      scroll-behavior: smooth;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
      color: var(--text-primary);
      min-height: 100vh;
      overflow-x: hidden;
      line-height: 1.6;
    }

    /* ========== HEADER ========== */
    .header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: rgba(15, 26, 48, 0.95);
      backdrop-filter: blur(20px);
      z-index: 1000;
      border-bottom: 1px solid var(--border-color);
      padding: 1rem 2rem;
    }

    .header-container {
      max-width: 1400px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo-link {
      display: flex;
      align-items: center;
      gap: 12px;
      text-decoration: none;
    }

    .logo-img {
      height: 45px;
      width: auto;
      border-radius: 8px;
    }

    .logo-text {
      display: flex;
      flex-direction: column;
      font-family: 'Poppins', sans-serif;
    }

    .logo-main {
      font-weight: 700;
      font-size: 1.2rem;
      color: white;
      line-height: 1.1;
    }

    .logo-sub {
      font-size: 0.8rem;
      color: var(--accent-color);
      font-weight: 500;
    }

    .back-btn {
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      color: white;
      border: none;
      padding: 0.8rem 1.5rem;
      border-radius: var(--radius-md);
      font-weight: 600;
      font-size: 0.9rem;
      cursor: pointer;
      transition: var(--transition);
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .back-btn:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    /* ========== MAIN ========== */
    .main-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 5rem 1rem 1rem;
    }

    /* ========== HERO ========== */
    .hero-section {
      text-align: center;
      padding: 2rem 0 3rem;
      position: relative;
    }

    .hero-badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: rgba(0, 191, 165, 0.1);
      color: var(--accent-color);
      padding: 0.5rem 1rem;
      border-radius: 50px;
      font-weight: 600;
      font-size: 0.85rem;
      margin-bottom: 1.5rem;
    }

    .hero-title {
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 1rem;
      background: linear-gradient(135deg, var(--text-primary), var(--accent-color));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      line-height: 1.2;
    }

    .hero-subtitle {
      font-size: 1.1rem;
      color: var(--text-secondary);
      max-width: 600px;
      margin: 0 auto 2rem;
    }

    .hero-cta {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      background: linear-gradient(135deg, var(--accent-color), var(--accent-dark));
      color: white;
      padding: 0.9rem 2rem;
      border-radius: 50px;
      font-weight: 600;
      text-decoration: none;
      transition: var(--transition);
    }

    .hero-cta:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 25px rgba(0, 191, 165, 0.4);
    }

    /* ========== STATS CARDS ========== */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 1.5rem;
      margin: 3rem 0;
    }

    .stat-card {
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-lg);
      padding: 1.5rem;
      text-align: center;
      backdrop-filter: blur(10px);
      transition: var(--transition);
    }

    .stat-card:hover {
      border-color: var(--accent-color);
      transform: translateY(-5px);
    }

    .stat-icon {
      font-size: 2rem;
      color: var(--accent-color);
      margin-bottom: 0.8rem;
    }

    .stat-number {
      font-size: 2.2rem;
      font-weight: 700;
      color: white;
      line-height: 1;
    }

    .stat-label {
      color: var(--text-tertiary);
      font-size: 0.9rem;
      margin-top: 0.3rem;
    }

    /* ========== SECTION TITLES ========== */
    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
    }

    .section-title {
      font-size: 1.8rem;
      font-weight: 700;
      color: white;
    }

    .section-link {
      color: var(--accent-color);
      text-decoration: none;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    /* ========== BOUTONS CRÉATION ========== */
    .create-btn {
      background: rgba(0, 191, 165, 0.1);
      border: 1px solid var(--accent-color);
      color: var(--accent-color);
      padding: 0.5rem 1rem;
      border-radius: var(--radius-md);
      font-weight: 600;
      font-size: 0.9rem;
      cursor: pointer;
      transition: var(--transition);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      margin-left: 1rem;
    }

    .create-btn:hover {
      background: var(--accent-color);
      color: white;
    }

    /* ========== FORMULAIRES ========== */
    .create-form {
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-lg);
      padding: 1.5rem;
      margin-bottom: 2rem;
      display: none;
    }

    .create-form.visible {
      display: block;
    }

    .form-group {
      margin-bottom: 1rem;
    }

    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      color: var(--text-secondary);
      font-size: 0.9rem;
    }

    .form-group input, .form-group select, .form-group textarea {
      width: 100%;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      padding: 0.7rem 1rem;
      color: var(--text-primary);
      font-size: 0.95rem;
    }

    .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
      outline: none;
      border-color: var(--accent-color);
    }

    .form-actions {
      display: flex;
      gap: 1rem;
      justify-content: flex-end;
    }

    .form-actions button {
      padding: 0.6rem 1.2rem;
      border-radius: var(--radius-md);
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      border: none;
    }

    .form-actions .cancel {
      background: transparent;
      border: 1px solid var(--border-color);
      color: var(--text-secondary);
    }

    .form-actions .submit {
      background: linear-gradient(135deg, var(--accent-color), var(--accent-dark));
      color: white;
    }

    /* ========== POSTS ========== */
    .new-post-form {
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-lg);
      padding: 1.5rem;
      margin-bottom: 2rem;
    }

    .new-post-form textarea {
      width: 100%;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      padding: 0.9rem 1.2rem;
      color: var(--text-primary);
      font-size: 0.95rem;
      resize: vertical;
      min-height: 100px;
      font-family: 'Inter', sans-serif;
      margin-bottom: 1rem;
    }

    .new-post-form textarea:focus {
      outline: none;
      border-color: var(--accent-color);
    }

    .post-submit-btn {
      background: linear-gradient(135deg, var(--accent-color), var(--accent-dark));
      color: white;
      border: none;
      padding: 0.7rem 1.5rem;
      border-radius: var(--radius-md);
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .post-submit-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 191, 165, 0.3);
    }

    .posts-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 1.5rem;
      margin-bottom: 3rem;
    }

    .post-card {
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-lg);
      padding: 1.5rem;
      transition: var(--transition);
    }

    .post-card:hover {
      border-color: var(--accent-color);
      box-shadow: var(--shadow-md);
    }

    .post-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 1rem;
    }

    .post-avatar {
      width: 45px;
      height: 45px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      color: white;
    }

    .post-author {
      font-weight: 600;
      color: white;
    }

    .post-time {
      font-size: 0.8rem;
      color: var(--text-tertiary);
    }

    .post-content {
      color: var(--text-secondary);
      margin-bottom: 1rem;
      font-size: 0.95rem;
      word-wrap: break-word;
    }

    .post-stats {
      display: flex;
      gap: 1rem;
      border-top: 1px solid var(--border-color);
      padding-top: 1rem;
      margin-top: 0.5rem;
    }

    .post-stat {
      display: flex;
      align-items: center;
      gap: 6px;
      color: var(--text-tertiary);
      font-size: 0.85rem;
      cursor: pointer;
      transition: var(--transition);
    }

    .post-stat:hover {
      color: var(--accent-color);
    }

    .post-stat i {
      font-size: 1rem;
    }

    .liked {
      color: #ff6b6b !important;
    }

    /* ========== COMMENTAIRES ========== */
    .comments-section {
      margin-top: 1rem;
      border-top: 1px solid var(--border-color);
      padding-top: 1rem;
    }

    .comment {
      display: flex;
      gap: 10px;
      margin-bottom: 0.8rem;
      font-size: 0.9rem;
    }

    .comment-avatar {
      width: 30px;
      height: 30px;
      background: var(--primary-color);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8rem;
      color: white;
      flex-shrink: 0;
    }

    .comment-content {
      background: rgba(255,255,255,0.03);
      padding: 0.5rem 0.8rem;
      border-radius: var(--radius-md);
      flex: 1;
    }

    .comment-author {
      font-weight: 600;
      color: var(--accent-color);
      font-size: 0.8rem;
      margin-bottom: 0.2rem;
    }

    .comment-text {
      color: var(--text-secondary);
      word-wrap: break-word;
    }

    .comment-time {
      font-size: 0.65rem;
      color: var(--text-tertiary);
      margin-top: 0.2rem;
    }

    .add-comment {
      display: flex;
      gap: 8px;
      margin-top: 0.8rem;
    }

    .add-comment input {
      flex: 1;
      background: rgba(255,255,255,0.05);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      padding: 0.5rem 0.8rem;
      color: var(--text-primary);
      font-size: 0.85rem;
    }

    .add-comment input:focus {
      outline: none;
      border-color: var(--accent-color);
    }

    .add-comment button {
      background: linear-gradient(135deg, var(--accent-color), var(--accent-dark));
      border: none;
      width: 35px;
      height: 35px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      cursor: pointer;
      transition: var(--transition);
    }

    .add-comment button:hover {
      transform: scale(1.05);
    }

    /* ========== MEMBRES EN LIGNE ========== */
    .members-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 1.2rem;
      margin-bottom: 3rem;
    }

    .member-card {
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      padding: 1.2rem;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .member-avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: linear-gradient(145deg, var(--bg-tertiary), var(--bg-secondary));
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      color: white;
      position: relative;
    }

    .online-dot {
      position: absolute;
      bottom: 2px;
      right: 2px;
      width: 12px;
      height: 12px;
      background: #4CAF50;
      border: 2px solid var(--bg-secondary);
      border-radius: 50%;
    }

    .member-info h4 {
      font-size: 1rem;
      margin-bottom: 4px;
    }

    .member-role {
      font-size: 0.75rem;
      color: var(--text-tertiary);
    }

    /* ========== GROUPES ========== */
    .groups-header {
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .groups-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .group-card {
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-lg);
      padding: 1.5rem;
      transition: var(--transition);
    }

    .group-card:hover {
      border-color: var(--accent-color);
    }

    .group-icon {
      width: 60px;
      height: 60px;
      background: rgba(0, 191, 165, 0.1);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.8rem;
      color: var(--accent-color);
      margin-bottom: 1rem;
    }

    .group-name {
      font-weight: 600;
      font-size: 1.1rem;
      margin-bottom: 0.3rem;
    }

    .group-members {
      color: var(--text-tertiary);
      font-size: 0.9rem;
      margin-bottom: 1rem;
    }

    .group-type {
      display: inline-block;
      padding: 0.2rem 0.8rem;
      border-radius: 20px;
      font-size: 0.7rem;
      font-weight: 600;
      background: rgba(255,255,255,0.1);
      margin-bottom: 1rem;
    }

    .group-actions {
      display: flex;
      gap: 0.8rem;
      flex-wrap: wrap;
    }

    .group-btn {
      padding: 0.5rem 1rem;
      border-radius: var(--radius-md);
      font-weight: 600;
      font-size: 0.8rem;
      cursor: pointer;
      transition: var(--transition);
      border: 1px solid transparent;
      background: rgba(255,255,255,0.1);
      color: white;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 5px;
    }

    .group-btn.join {
      background: rgba(0, 191, 165, 0.2);
      color: var(--accent-color);
      border-color: var(--accent-color);
    }

    .group-btn.join:hover {
      background: var(--accent-color);
      color: white;
    }

    .group-btn.leave {
      background: rgba(255, 107, 107, 0.2);
      color: #ff6b6b;
      border-color: #ff6b6b;
    }

    .group-btn.leave:hover {
      background: #ff6b6b;
      color: white;
    }

    .group-btn.messages {
      background: var(--bg-tertiary);
    }

    .group-chat {
      margin-top: 1.5rem;
      border-top: 1px solid var(--border-color);
      padding-top: 1rem;
      display: none;
    }

    .group-chat.visible {
      display: block;
    }

    .group-messages {
      max-height: 200px;
      overflow-y: auto;
      background: rgba(0,0,0,0.2);
      border-radius: var(--radius-md);
      padding: 0.8rem;
      margin-bottom: 1rem;
    }

    .group-message {
      display: flex;
      gap: 8px;
      margin-bottom: 0.8rem;
    }

    .group-message-avatar {
      width: 30px;
      height: 30px;
      background: var(--primary-color);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8rem;
      color: white;
      flex-shrink: 0;
    }

    .group-message-content {
      background: var(--card-bg);
      padding: 0.5rem 0.8rem;
      border-radius: var(--radius-md);
      flex: 1;
    }

    .group-message-author {
      font-weight: 600;
      font-size: 0.8rem;
      color: var(--accent-color);
    }

    .group-message-text {
      font-size: 0.85rem;
      color: var(--text-secondary);
    }

    .group-message-time {
      font-size: 0.65rem;
      color: var(--text-tertiary);
      margin-top: 0.2rem;
    }

    .group-chat-input {
      display: flex;
      gap: 8px;
    }

    .group-chat-input input {
      flex: 1;
      background: rgba(255,255,255,0.05);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      padding: 0.6rem 0.8rem;
      color: var(--text-primary);
    }

    .group-chat-input button {
      background: linear-gradient(135deg, var(--accent-color), var(--accent-dark));
      border: none;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      color: white;
      cursor: pointer;
    }

    /* ========== ÉVÉNEMENTS ========== */
    .events-header {
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .events-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 1.5rem;
      margin-bottom: 3rem;
    }

    .event-card {
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-lg);
      padding: 1.2rem;
      display: flex;
      gap: 1rem;
      align-items: center;
    }

    .event-date {
      background: rgba(0, 191, 165, 0.1);
      border-radius: var(--radius-md);
      padding: 0.5rem;
      min-width: 60px;
      text-align: center;
    }

    .event-day {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--accent-color);
      line-height: 1;
    }

    .event-month {
      font-size: 0.7rem;
      color: var(--text-tertiary);
      text-transform: uppercase;
    }

    .event-details {
      flex: 1;
    }

    .event-details h4 {
      font-size: 1rem;
      margin-bottom: 0.3rem;
    }

    .event-meta {
      display: flex;
      gap: 12px;
      color: var(--text-tertiary);
      font-size: 0.75rem;
      margin-top: 0.5rem;
    }

    .join-event-btn {
      background: transparent;
      border: 1px solid var(--accent-color);
      color: var(--accent-color);
      padding: 0.3rem 1rem;
      border-radius: 20px;
      font-size: 0.7rem;
      cursor: pointer;
      transition: var(--transition);
      margin-top: 0.5rem;
    }

    .join-event-btn:hover {
      background: var(--accent-color);
      color: white;
    }

    .joined-event {
      background: var(--accent-color);
      color: white;
    }

    /* ========== CHAT GLOBAL ========== */
    .community-chat {
      background: var(--bg-tertiary);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-lg);
      padding: 1.5rem;
      margin: 3rem 0;
    }

    .chat-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 1.5rem;
    }

    .chat-header i {
      font-size: 1.8rem;
      color: var(--accent-color);
    }

    .chat-title h3 {
      font-size: 1.2rem;
      margin-bottom: 4px;
    }

    .chat-title p {
      color: var(--text-tertiary);
      font-size: 0.8rem;
    }

    .chat-messages {
      height: 250px;
      overflow-y: auto;
      background: rgba(0, 0, 0, 0.2);
      border-radius: var(--radius-md);
      padding: 1rem;
      margin-bottom: 1rem;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .chat-message {
      display: flex;
      align-items: flex-start;
      gap: 10px;
    }

    .chat-message-avatar {
      width: 35px;
      height: 35px;
      background: var(--primary-color);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.9rem;
      color: white;
      flex-shrink: 0;
    }

    .chat-message-content {
      background: var(--card-bg);
      padding: 0.6rem 1rem;
      border-radius: var(--radius-md);
      max-width: 80%;
    }

    .chat-message-author {
      font-weight: 600;
      font-size: 0.8rem;
      color: var(--accent-color);
      margin-bottom: 4px;
    }

    .chat-message-text {
      color: var(--text-secondary);
      font-size: 0.9rem;
      word-wrap: break-word;
    }

    .chat-input-area {
      display: flex;
      gap: 10px;
    }

    .chat-input {
      flex: 1;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      padding: 0.8rem 1rem;
      color: var(--text-primary);
      font-size: 0.95rem;
    }

    .chat-input:focus {
      outline: none;
      border-color: var(--accent-color);
    }

    .chat-send {
      background: linear-gradient(135deg, var(--accent-color), var(--accent-dark));
      border: none;
      width: 45px;
      height: 45px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      cursor: pointer;
      transition: var(--transition);
    }

    .chat-send:hover {
      transform: scale(1.05);
    }

    /* ========== TÉMOIGNAGES ========== */
    .testimonials-slider {
      display: flex;
      gap: 1.5rem;
      overflow-x: auto;
      padding-bottom: 1rem;
      margin-bottom: 2rem;
      scroll-snap-type: x mandatory;
    }

    .testimonial-card {
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-lg);
      padding: 1.8rem;
      min-width: 300px;
      flex: 0 0 auto;
      scroll-snap-align: start;
    }

    .testimonial-text {
      font-style: italic;
      color: var(--text-secondary);
      margin-bottom: 1.2rem;
    }

    .testimonial-author {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .testimonial-avatar {
      width: 45px;
      height: 45px;
      border-radius: 50%;
      background: var(--primary-color);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
    }

    .testimonial-name {
      font-weight: 600;
    }

    .testimonial-role {
      font-size: 0.75rem;
      color: var(--text-tertiary);
    }

    /* ========== FOOTER ========== */
    .footer {
      background: var(--bg-tertiary);
      border-top: 1px solid var(--border-color);
      padding: 2rem 1rem 1.5rem;
      margin-top: 3rem;
    }

    .footer-content {
      max-width: 1200px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 2rem;
    }

    .footer-section h3 {
      font-size: 1rem;
      font-weight: 700;
      margin-bottom: 1rem;
      color: white;
    }

    .footer-links {
      list-style: none;
    }

    .footer-links li {
      margin-bottom: 0.5rem;
    }

    .footer-links a {
      color: var(--text-secondary);
      text-decoration: none;
      transition: var(--transition);
      font-size: 0.9rem;
    }

    .footer-links a:hover {
      color: var(--accent-color);
    }

    .footer-bottom {
      text-align: center;
      padding-top: 1.5rem;
      margin-top: 2rem;
      border-top: 1px solid rgba(255, 255, 255, 0.05);
      color: var(--text-tertiary);
      font-size: 0.85rem;
    }

    /* ========== RESPONSIVE ========== */
    @media (max-width: 900px) {
      .stats-grid { grid-template-columns: repeat(2, 1fr); }
    }
    @media (max-width: 768px) {
      .header { padding: 0.8rem 1rem; }
      .main-container { padding: 4rem 0.5rem; }
      .hero-title { font-size: 2rem; }
      .stats-grid { grid-template-columns: 1fr; }
      .section-title { font-size: 1.5rem; }
    }
    @media (max-width: 480px) {
      .hero-title { font-size: 1.7rem; }
      .member-card { flex-direction: column; text-align: center; }
    }
  </style>
</head>
<body>
  <!-- ========== HEADER ========== -->
  <header class="header">
    <div class="header-container">
      <a href="dashboard.html" class="logo-link">
        <img src="https://raw.githubusercontent.com/exaucenapopolo/Social-Boost-Horizon-/refs/heads/main/assets/logos/Logo%20social%20Boost%20horizon.jpg" 
             alt="Social Boost Horizon" class="logo-img">
        <div class="logo-text">
          <span class="logo-main">Social Boost Horizon</span>
          <span class="logo-sub">Communauté</span>
        </div>
      </a>
      <a href="dashboard.html" class="back-btn">
        <i class="fas fa-arrow-left"></i> Dashboard
      </a>
    </div>
  </header>

  <!-- ========== MAIN ========== -->
  <main class="main-container">
    <!-- ========== HERO ========== -->
    <section class="hero-section" data-aos="fade-up">
      <div class="hero-badge">
        <i class="fas fa-users"></i> Communauté Horizon
      </div>
      <h1 class="hero-title">Ensemble, grandissons plus vite</h1>
      <p class="hero-subtitle">
        Échangez avec des milliers de créateurs, partagez vos stratégies et boostez votre réseau.
      </p>
      <button id="joinCommunityBtn" class="hero-cta">
        <i class="fas fa-user-plus"></i> Rejoindre la communauté
      </button>
    </section>

    <!-- ========== STATISTIQUES ========== -->
    <div class="stats-grid" data-aos="fade-up" data-aos-delay="100">
      <div class="stat-card">
        <div class="stat-icon"><i class="fas fa-user-friends"></i></div>
        <div class="stat-number" id="stat-members">0</div>
        <div class="stat-label">Membres en ligne</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon"><i class="fas fa-comments"></i></div>
        <div class="stat-number" id="stat-messages">0</div>
        <div class="stat-label">Messages échangés</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon"><i class="fas fa-layer-group"></i></div>
        <div class="stat-number" id="stat-groups">0</div>
        <div class="stat-label">Groupes de discussion</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon"><i class="fas fa-calendar-check"></i></div>
        <div class="stat-number" id="stat-events">0</div>
        <div class="stat-label">Événements à venir</div>
      </div>
    </div>

    <!-- ========== ACTIVITÉ RÉCENTE ========== -->
    <section data-aos="fade-up">
      <div class="section-header">
        <h2 class="section-title"><i class="fas fa-rss" style="margin-right: 10px; color: var(--accent-color);"></i> Activité récente</h2>
        <a href="#" class="section-link">Voir tout <i class="fas fa-arrow-right"></i></a>
      </div>

      <!-- Formulaire de post (visible si connecté) -->
      <div id="newPostFormContainer" style="display: none;" class="new-post-form">
        <textarea id="postContentInput" placeholder="Partagez votre expérience, posez une question..."></textarea>
        <button id="submitPostBtn" class="post-submit-btn"><i class="fas fa-paper-plane"></i> Publier</button>
      </div>

      <!-- Grille des posts -->
      <div class="posts-grid" id="postsGrid"></div>
    </section>

    <!-- ========== MEMBRES EN LIGNE ========== -->
    <section data-aos="fade-up">
      <div class="section-header">
        <h2 class="section-title"><i class="fas fa-circle" style="margin-right: 10px; color: #4CAF50; font-size: 0.9rem;"></i> Membres en ligne</h2>
        <a href="#" class="section-link">Tous les membres <i class="fas fa-arrow-right"></i></a>
      </div>
      <div class="members-grid" id="membersGrid"></div>
    </section>

    <!-- ========== GROUPES ========== -->
    <section data-aos="fade-up">
      <div class="groups-header">
        <h2 class="section-title"><i class="fas fa-object-group" style="margin-right: 10px; color: var(--accent-color);"></i> Groupes</h2>
        <button id="showCreateGroupFormBtn" class="create-btn"><i class="fas fa-plus"></i> Créer un groupe</button>
      </div>

      <!-- Formulaire de création de groupe -->
      <div id="createGroupForm" class="create-form">
        <h3 style="margin-bottom: 1rem;">Nouveau groupe</h3>
        <div class="form-group">
          <label>Nom du groupe</label>
          <input type="text" id="groupNameInput" placeholder="Ex: Stratégies Instagram" maxlength="50">
        </div>
        <div class="form-group">
          <label>Type</label>
          <select id="groupTypeSelect">
            <option value="public">Public</option>
            <option value="private">Privé</option>
          </select>
        </div>
        <div class="form-group">
          <label>Description (optionnelle)</label>
          <textarea id="groupDescInput" placeholder="Décrivez le sujet du groupe..." rows="2"></textarea>
        </div>
        <div class="form-actions">
          <button class="cancel" id="cancelCreateGroup">Annuler</button>
          <button class="submit" id="submitCreateGroup">Créer</button>
        </div>
      </div>

      <!-- Grille des groupes -->
      <div class="groups-grid" id="groupsGrid"></div>
    </section>

    <!-- ========== ÉVÉNEMENTS ========== -->
    <section data-aos="fade-up">
      <div class="events-header">
        <h2 class="section-title"><i class="fas fa-calendar-alt" style="margin-right: 10px; color: var(--accent-color);"></i> Événements</h2>
        <button id="showCreateEventFormBtn" class="create-btn"><i class="fas fa-plus"></i> Créer un événement</button>
      </div>

      <!-- Formulaire de création d'événement -->
      <div id="createEventForm" class="create-form">
        <h3 style="margin-bottom: 1rem;">Nouvel événement</h3>
        <div class="form-group">
          <label>Titre</label>
          <input type="text" id="eventTitleInput" placeholder="Ex: Webinar Instagram" maxlength="100">
        </div>
        <div class="form-group">
          <label>Jour</label>
          <input type="text" id="eventDayInput" placeholder="Ex: 15" maxlength="2">
        </div>
        <div class="form-group">
          <label>Mois</label>
          <input type="text" id="eventMonthInput" placeholder="Ex: Mai" maxlength="10">
        </div>
        <div class="form-group">
          <label>Heure</label>
          <input type="text" id="eventTimeInput" placeholder="Ex: 18h" maxlength="10">
        </div>
        <div class="form-actions">
          <button class="cancel" id="cancelCreateEvent">Annuler</button>
          <button class="submit" id="submitCreateEvent">Créer</button>
        </div>
      </div>

      <!-- Grille des événements -->
      <div class="events-grid" id="eventsGrid"></div>
    </section>

    <!-- ========== CHAT COMMUNAUTAIRE ========== -->
    <section class="community-chat" data-aos="fade-up" data-aos-delay="200">
      <div class="chat-header">
        <i class="fas fa-comment-dots"></i>
        <div class="chat-title">
          <h3>Discussion en direct</h3>
          <p>Échangez instantanément avec la communauté</p>
        </div>
      </div>

      <!-- Messages du chat -->
      <div class="chat-messages" id="chatMessages"></div>

      <!-- Zone de saisie -->
      <div class="chat-input-area">
        <input type="text" class="chat-input" id="chatInput" placeholder="Votre message..." maxlength="200" disabled>
        <button class="chat-send" id="chatSendBtn" disabled><i class="fas fa-paper-plane"></i></button>
      </div>
      <p style="color: var(--text-tertiary); font-size: 0.75rem; margin-top: 0.5rem;">
        <i class="fas fa-info-circle"></i> Connectez‑vous pour participer au chat et publier des posts.
      </p>
    </section>

    <!-- ========== TÉMOIGNAGES ========== -->
    <section data-aos="fade-up">
      <div class="section-header">
        <h2 class="section-title"><i class="fas fa-quote-right" style="margin-right: 10px; color: var(--accent-color);"></i> Ils parlent de nous</h2>
      </div>
      <div class="testimonials-slider" id="testimonialsSlider"></div>
    </section>
  </main>

  <!-- ========== FOOTER ========== -->
  <footer class="footer">
    <div class="footer-content">
      <div class="footer-section">
        <h3>Social Boost Horizon</h3>
        <p style="color: var(--text-secondary); margin-top: 0.5rem; font-size: 0.9rem;">Votre partenaire pour une croissance intelligente sur les réseaux sociaux.</p>
      </div>
      <div class="footer-section">
        <h3>Liens Rapides</h3>
        <ul class="footer-links">
          <li><a href="dashboard.html">Dashboard</a></li>
          <li><a href="services.html">Services</a></li>
          <li><a href="strategie-de-boost.html">Stratégies</a></li>
          <li><a href="assistance.html">Assistance</a></li>
        </ul>
      </div>
      <div class="footer-section">
        <h3>Communauté</h3>
        <ul class="footer-links">
          <li><a href="communaute.html">Fil d'actualité</a></li>
          <li><a href="groupes.html">Groupes</a></li>
          <li><a href="evenements.html">Événements</a></li>
          <li><a href="membres.html">Membres</a></li>
        </ul>
      </div>
    </div>
    <div class="footer-bottom">
      <p>&copy; 2026 Social Boost Horizon. Tous droits réservés.</p>
    </div>
  </footer>

  <!-- ========== SCRIPTS ========== -->
  <script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
  <script>
    // ============================================
    //  CONFIGURATION FIREBASE
    // ============================================
    const firebaseConfig = {
      apiKey: "AIzaSyD2JiDS0g8EkeNXxjO7_wGI3WznpPvcCCk",
      authDomain: "social-boost-horizon.firebaseapp.com",
      projectId: "social-boost-horizon",
      storageBucket: "social-boost-horizon.appspot.com",
      messagingSenderId: "43658165639",
      appId: "1:43658165639:web:b8f492dc6a25cd12fc6722",
      databaseURL: "https://social-boost-horizon-default-rtdb.firebaseio.com/"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    // ============================================
    //  INITIALISATION AOS
    // ============================================
    AOS.init({ duration: 800, once: true, offset: 100 });

    // ============================================
    //  ÉTAT GLOBAL
    // ============================================
    let currentUser = null;
    let currentUserName = "Anonyme";

    // ============================================
    //  INITIALISATION DES DONNÉES DE DÉMO (avec structure sécurisée)
    // ============================================
    async function initializeDefaultData() {
      // --- GROUPES DE DÉMO ---
      const groupsSnap = await db.ref('community/groups').once('value');
      if (!groupsSnap.exists()) {
        const demoGroups = {
          group1: { 
            name: "Stratégies Instagram", 
            type: "public",
            ownerId: "demo", 
            members: { demo: true }, 
            admins: { demo: true },
            description: "Astuces, algorithmes et retours d'expérience",
            icon: "fa-instagram"
          },
          group2: { 
            name: "Boost TikTok", 
            type: "public",
            ownerId: "demo", 
            members: { demo: true }, 
            admins: { demo: true },
            description: "Vidéos virales et croissance express",
            icon: "fa-tiktok"
          },
          group3: { 
            name: "Monétisation YouTube", 
            type: "public",
            ownerId: "demo", 
            members: { demo: true }, 
            admins: { demo: true },
            description: "Gagner sa vie grâce à sa chaîne",
            icon: "fa-youtube"
          }
        };
        await db.ref('community/groups').set(demoGroups);
      }

      // --- ÉVÉNEMENTS DE DÉMO ---
      const eventsSnap = await db.ref('community/events').once('value');
      if (!eventsSnap.exists()) {
        const demoEvents = {
          event1: { 
            day: "15", month: "Mai", 
            title: "Webinar : Booster sans se faire bannir", 
            time: "18h", 
            creatorId: "demo",
            participants: {} 
          },
          event2: { 
            day: "22", month: "Mai", 
            title: "Atelier : Créer des visuels qui convertissent", 
            time: "20h", 
            creatorId: "demo",
            participants: {} 
          },
          event3: { 
            day: "05", month: "Juin", 
            title: "AMA avec un expert Instagram", 
            time: "19h", 
            creatorId: "demo",
            participants: {} 
          }
        };
        await db.ref('community/events').set(demoEvents);
      }

      // --- TÉMOIGNAGES (inchangés) ---
      const testimonialsSnap = await db.ref('community/testimonials').once('value');
      if (!testimonialsSnap.exists()) {
        await db.ref('community/testimonials').set({
          t1: { text: "Grâce aux conseils de la communauté, j'ai multiplié mon engagement par 3 en 2 semaines.", author: "Marc D.", role: "Créateur voyage" },
          t2: { text: "Le chat est super réactif, on se sent vraiment entouré.", author: "Léa P.", role: "Beauté" },
          t3: { text: "J'ai découvert des méthodes que je n'aurais jamais trouvé seul. Merci !", author: "Youssef K.", role: "Gaming" }
        });
      }
    }
    initializeDefaultData().catch(console.error);

    // ============================================
    //  AUTHENTIFICATION & PRÉSENCE
    // ============================================
    auth.onAuthStateChanged(async (user) => {
      currentUser = user;
      const formContainer = document.getElementById('newPostFormContainer');
      const chatInput = document.getElementById('chatInput');
      const chatSend = document.getElementById('chatSendBtn');
      const joinBtn = document.getElementById('joinCommunityBtn');

      if (user) {
        currentUserName = user.displayName || user.email.split('@')[0];

        // Enregistrer le membre
        const memberRef = db.ref(`community/members/${user.uid}`);
        await memberRef.update({
          name: currentUserName,
          email: user.email,
          lastOnline: firebase.database.ServerValue.TIMESTAMP
        });

        // Gestion de la présence
        const userStatusRef = db.ref(`community/members/${user.uid}/online`);
        const connectedRef = db.ref('.info/connected');
        connectedRef.on('value', (snap) => {
          if (snap.val() === true) {
            userStatusRef.set(true);
            userStatusRef.onDisconnect().set(false);
          }
        });

        formContainer.style.display = 'block';
        chatInput.disabled = false;
        chatSend.disabled = false;
        joinBtn.style.display = 'none';
      } else {
        formContainer.style.display = 'none';
        chatInput.disabled = true;
        chatSend.disabled = true;
        joinBtn.style.display = 'inline-flex';
        currentUser = null;
        currentUserName = "Anonyme";
      }
    });

    document.getElementById('joinCommunityBtn').addEventListener('click', () => {
      if (!currentUser) window.location.href = "login.html";
    });

    // ============================================
    //  STATISTIQUES
    // ============================================
    db.ref('community/members').on('value', (snapshot) => {
      let online = 0;
      snapshot.forEach(child => { if (child.val().online === true) online++; });
      document.getElementById('stat-members').innerText = online;
    });

    db.ref('community/chat').on('value', (snapshot) => {
      document.getElementById('stat-messages').innerText = snapshot.numChildren() || 0;
    });

    db.ref('community/groups').on('value', (snapshot) => {
      document.getElementById('stat-groups').innerText = snapshot.numChildren() || 0;
    });

    db.ref('community/events').on('value', (snapshot) => {
      document.getElementById('stat-events').innerText = snapshot.numChildren() || 0;
    });

    // ============================================
    //  POSTS (inchangé, déjà avec authorId)
    // ============================================
    const postsGrid = document.getElementById('postsGrid');
    db.ref('community/posts').orderByChild('timestamp').limitToLast(20).on('value', async (snapshot) => {
      const posts = [];
      const promises = [];
      snapshot.forEach(child => {
        const post = { id: child.key, ...child.val() };
        posts.push(post);
        const commentsPromise = db.ref(`community/comments/${child.key}`).once('value').then(commentsSnap => {
          post.comments = [];
          commentsSnap.forEach(commentChild => {
            post.comments.push({ id: commentChild.key, ...commentChild.val() });
          });
          post.comments.sort((a, b) => (a.timestamp || 0) - (b.timestamp || 0));
        });
        promises.push(commentsPromise);
      });
      await Promise.all(promises);
      posts.reverse();
      renderPosts(posts);
    });

    function renderPosts(posts) {
      postsGrid.innerHTML = posts.map(post => `
        <div class="post-card" data-post-id="${post.id}">
          <div class="post-header">
            <div class="post-avatar">${post.authorName ? post.authorName.charAt(0) : 'A'}</div>
            <div>
              <div class="post-author">${post.authorName || 'Anonyme'}</div>
              <div class="post-time">${formatTime(post.timestamp)}</div>
            </div>
          </div>
          <div class="post-content">${escapeHtml(post.content)}</div>
          <div class="post-stats">
            <span class="post-stat like-btn" data-post-id="${post.id}">
              <i class="${post.likes && post.likes[currentUser?.uid] ? 'fas' : 'far'} fa-heart ${post.likes && post.likes[currentUser?.uid] ? 'liked' : ''}"></i>
              ${post.likesCount || 0}
            </span>
            <span class="post-stat comment-toggle" data-post-id="${post.id}">
              <i class="far fa-comment"></i> ${post.commentsCount || 0}
            </span>
            <span class="post-stat"><i class="far fa-share-square"></i> 0</span>
          </div>
          <div class="comments-section" id="comments-${post.id}" style="display: none;">
            ${renderComments(post.comments)}
            <div class="add-comment">
              <input type="text" id="comment-input-${post.id}" placeholder="Écrire un commentaire..." maxlength="200">
              <button class="comment-send" data-post-id="${post.id}"><i class="fas fa-paper-plane"></i></button>
            </div>
          </div>
        </div>
      `).join('');
      attachLikeListeners();
      attachCommentToggleListeners();
      attachCommentSendListeners();
    }

    function renderComments(comments) {
      if (!comments || comments.length === 0) return '<p style="color: var(--text-tertiary); font-size:0.8rem;">Aucun commentaire pour le moment.</p>';
      return comments.map(c => `
        <div class="comment">
          <div class="comment-avatar">${c.authorName ? c.authorName.charAt(0) : 'A'}</div>
          <div class="comment-content">
            <div class="comment-author">${c.authorName || 'Anonyme'}</div>
            <div class="comment-text">${escapeHtml(c.content)}</div>
            <div class="comment-time">${formatTime(c.timestamp)}</div>
          </div>
        </div>
      `).join('');
    }

    document.getElementById('submitPostBtn').addEventListener('click', async () => {
      const content = document.getElementById('postContentInput').value.trim();
      if (!content || !currentUser) return;
      const newPostRef = db.ref('community/posts').push();
      await newPostRef.set({
        authorId: currentUser.uid,
        authorName: currentUserName,
        content: content,
        timestamp: firebase.database.ServerValue.TIMESTAMP,
        likesCount: 0,
        commentsCount: 0
      });
      document.getElementById('postContentInput').value = '';
    });

    function attachLikeListeners() {
      document.querySelectorAll('.like-btn').forEach(btn => {
        btn.removeEventListener('click', handleLike);
        btn.addEventListener('click', handleLike);
      });
    }
    async function handleLike(e) {
      e.preventDefault();
      if (!currentUser) { alert('Veuillez vous connecter.'); return; }
      const postId = this.dataset.postId;
      const likeRef = db.ref(`community/likes/${postId}/${currentUser.uid}`);
      const postRef = db.ref(`community/posts/${postId}`);
      const snapshot = await likeRef.once('value');
      if (snapshot.val()) {
        await likeRef.remove();
        await postRef.child('likesCount').transaction(current => (current || 1) - 1);
      } else {
        await likeRef.set(true);
        await postRef.child('likesCount').transaction(current => (current || 0) + 1);
      }
    }

    function attachCommentToggleListeners() {
      document.querySelectorAll('.comment-toggle').forEach(btn => {
        btn.removeEventListener('click', toggleComments);
        btn.addEventListener('click', toggleComments);
      });
    }
    function toggleComments(e) {
      const postId = this.dataset.postId;
      const commentsDiv = document.getElementById(`comments-${postId}`);
      commentsDiv.style.display = commentsDiv.style.display === 'none' ? 'block' : 'none';
    }

    function attachCommentSendListeners() {
      document.querySelectorAll('.comment-send').forEach(btn => {
        btn.removeEventListener('click', sendComment);
        btn.addEventListener('click', sendComment);
      });
    }
    async function sendComment(e) {
      const postId = this.dataset.postId;
      const input = document.getElementById(`comment-input-${postId}`);
      const content = input.value.trim();
      if (!content || !currentUser) return;
      const commentRef = db.ref(`community/comments/${postId}`).push();
      await commentRef.set({
        authorId: currentUser.uid,
        authorName: currentUserName,
        content: content,
        timestamp: firebase.database.ServerValue.TIMESTAMP
      });
      await db.ref(`community/posts/${postId}/commentsCount`).transaction(current => (current || 0) + 1);
      input.value = '';
    }

    // ============================================
    //  MEMBRES EN LIGNE
    // ============================================
    db.ref('community/members').on('value', (snapshot) => {
      const members = [];
      snapshot.forEach(child => {
        const data = child.val();
        if (data.online === true) {
          members.push({ name: data.name || 'Membre', role: 'En ligne', online: true });
        }
      });
      document.getElementById('membersGrid').innerHTML = members.map(m => `
        <div class="member-card">
          <div class="member-avatar">
            ${m.name.charAt(0)}
            <span class="online-dot"></span>
          </div>
          <div class="member-info">
            <h4>${m.name}</h4>
            <div class="member-role">${m.role}</div>
          </div>
        </div>
      `).join('');
    });

    // ============================================
    //  GROUPES (création, adhésion, messages)
    // ============================================
    // Afficher/masquer formulaire de création
    document.getElementById('showCreateGroupFormBtn').addEventListener('click', () => {
      document.getElementById('createGroupForm').classList.toggle('visible');
    });
    document.getElementById('cancelCreateGroup').addEventListener('click', () => {
      document.getElementById('createGroupForm').classList.remove('visible');
    });

    // Soumission création groupe
    document.getElementById('submitCreateGroup').addEventListener('click', async () => {
      if (!currentUser) return alert('Connectez-vous d\'abord.');
      const name = document.getElementById('groupNameInput').value.trim();
      const type = document.getElementById('groupTypeSelect').value;
      const desc = document.getElementById('groupDescInput').value.trim();
      if (!name) return alert('Nom requis');
      
      const newGroupRef = db.ref('community/groups').push();
      await newGroupRef.set({
        name: name,
        type: type,
        description: desc || '',
        ownerId: currentUser.uid,
        members: { [currentUser.uid]: true },
        admins: { [currentUser.uid]: true },
        icon: 'fa-users', // icône par défaut
        createdAt: firebase.database.ServerValue.TIMESTAMP
      });
      
      // Réinitialiser et cacher le formulaire
      document.getElementById('groupNameInput').value = '';
      document.getElementById('groupDescInput').value = '';
      document.getElementById('createGroupForm').classList.remove('visible');
    });

    // Affichage des groupes en temps réel
    db.ref('community/groups').on('value', (snapshot) => {
      const groups = [];
      snapshot.forEach(child => {
        groups.push({ id: child.key, ...child.val() });
      });
      renderGroups(groups);
    });

    function renderGroups(groups) {
      const container = document.getElementById('groupsGrid');
      container.innerHTML = groups.map(group => {
        const memberCount = group.members ? Object.keys(group.members).length : 0;
        const isMember = currentUser && group.members && group.members[currentUser.uid];
        const isAdmin = currentUser && group.admins && group.admins[currentUser.uid];
        return `
          <div class="group-card" data-group-id="${group.id}">
            <div class="group-icon"><i class="fas ${group.icon || 'fa-users'}"></i></div>
            <div class="group-name">${escapeHtml(group.name)}</div>
            <div class="group-type">${group.type === 'private' ? 'Privé' : 'Public'}</div>
            <div class="group-members"><i class="fas fa-user"></i> ${memberCount} membre${memberCount > 1 ? 's' : ''}</div>
            <div class="group-actions">
              ${currentUser ? (isMember ? 
                `<button class="group-btn leave" data-group-id="${group.id}"><i class="fas fa-sign-out-alt"></i> Quitter</button>` :
                `<button class="group-btn join" data-group-id="${group.id}"><i class="fas fa-sign-in-alt"></i> Rejoindre</button>`
              ) : ''}
              <button class="group-btn messages" data-group-id="${group.id}"><i class="fas fa-comments"></i> Messages</button>
            </div>
            <!-- Zone de chat du groupe (cachée par défaut) -->
            <div class="group-chat" id="chat-${group.id}">
              <div class="group-messages" id="messages-${group.id}"></div>
              ${currentUser && isMember ? `
                <div class="group-chat-input">
                  <input type="text" id="group-input-${group.id}" placeholder="Votre message..." maxlength="200">
                  <button class="group-send" data-group-id="${group.id}"><i class="fas fa-paper-plane"></i></button>
                </div>
              ` : '<p style="color: var(--text-tertiary); font-size:0.8rem;">Rejoignez le groupe pour participer.</p>'}
            </div>
          </div>
        `;
      }).join('');

      // Attacher événements aux boutons
      document.querySelectorAll('.group-btn.join').forEach(btn => {
        btn.addEventListener('click', handleJoinGroup);
      });
      document.querySelectorAll('.group-btn.leave').forEach(btn => {
        btn.addEventListener('click', handleLeaveGroup);
      });
      document.querySelectorAll('.group-btn.messages').forEach(btn => {
        btn.addEventListener('click', toggleGroupChat);
      });
      document.querySelectorAll('.group-send').forEach(btn => {
        btn.addEventListener('click', sendGroupMessage);
      });
    }

    async function handleJoinGroup(e) {
      const groupId = this.dataset.groupId;
      if (!currentUser) return;
      await db.ref(`community/groups/${groupId}/members/${currentUser.uid}`).set(true);
    }

    async function handleLeaveGroup(e) {
      const groupId = this.dataset.groupId;
      if (!currentUser) return;
      await db.ref(`community/groups/${groupId}/members/${currentUser.uid}`).remove();
      // Si l'utilisateur était admin, on le retire aussi des admins (sauf si c'est le propriétaire)
      const groupSnap = await db.ref(`community/groups/${groupId}`).once('value');
      const group = groupSnap.val();
      if (group.ownerId !== currentUser.uid) {
        await db.ref(`community/groups/${groupId}/admins/${currentUser.uid}`).remove();
      }
    }

    function toggleGroupChat(e) {
      const groupId = this.dataset.groupId;
      const chatDiv = document.getElementById(`chat-${groupId}`);
      if (chatDiv.style.display === 'none' || !chatDiv.style.display) {
        chatDiv.style.display = 'block';
        // Charger les messages si ce n'est pas déjà fait (ils seront chargés via listener séparé)
      } else {
        chatDiv.style.display = 'none';
      }
    }

    // Écouter les messages de chaque groupe (on le fait une fois par groupe lors du rendu, mais on peut le faire globalement)
    // On va plutôt attacher un listener lors de l'ouverture du chat, mais pour simplifier, on peut écouter tous les messages de groupe
    // et les afficher dans le bon conteneur. On va utiliser un listener par groupe quand le chat est ouvert.
    // Ici, on va attacher un listener lors du clic sur "Messages" pour charger les messages.
    // Mais pour que ce soit réactif, on va plutôt utiliser un listener global sur les messages de groupe, mais il faudrait les filtrer par groupe.
    // On va opter pour un listener qui s'abonne quand le chat est ouvert, mais pour éviter les abonnements multiples, on va utiliser un système simple :
    // quand on clique sur "Messages", on vide le conteneur et on écoute les messages pour ce groupe.

    // Pour gérer simplement, on va attacher un listener sur tous les messages de groupe, mais cela pourrait être lourd.
    // On va plutôt utiliser un dictionnaire de listeners.

    const groupMessageListeners = {};

    function loadGroupMessages(groupId) {
      if (groupMessageListeners[groupId]) return; // déjà écouté
      const messagesRef = db.ref(`community/groups/${groupId}/messages`).orderByChild('timestamp').limitToLast(50);
      const callback = (snapshot) => {
        const msgs = [];
        snapshot.forEach(child => msgs.push({ id: child.key, ...child.val() }));
        msgs.sort((a, b) => (a.timestamp || 0) - (b.timestamp || 0));
        const container = document.getElementById(`messages-${groupId}`);
        if (container) {
          container.innerHTML = msgs.map(m => `
            <div class="group-message">
              <div class="group-message-avatar">${m.senderName ? m.senderName.charAt(0) : 'A'}</div>
              <div class="group-message-content">
                <div class="group-message-author">${m.senderName || 'Anonyme'}</div>
                <div class="group-message-text">${escapeHtml(m.text)}</div>
                <div class="group-message-time">${formatTime(m.timestamp)}</div>
              </div>
            </div>
          `).join('');
          container.scrollTop = container.scrollHeight;
        }
      };
      messagesRef.on('value', callback);
      groupMessageListeners[groupId] = { ref: messagesRef, callback };
    }

    // Modifier toggleGroupChat pour charger les messages
    function toggleGroupChat(e) {
      const groupId = this.dataset.groupId;
      const chatDiv = document.getElementById(`chat-${groupId}`);
      if (chatDiv.style.display === 'none' || !chatDiv.style.display) {
        chatDiv.style.display = 'block';
        loadGroupMessages(groupId);
      } else {
        chatDiv.style.display = 'none';
      }
    }

    async function sendGroupMessage(e) {
      const groupId = this.dataset.groupId;
      const input = document.getElementById(`group-input-${groupId}`);
      const text = input.value.trim();
      if (!text || !currentUser) return;
      const messageRef = db.ref(`community/groups/${groupId}/messages`).push();
      await messageRef.set({
        senderId: currentUser.uid,
        senderName: currentUserName,
        text: text,
        timestamp: firebase.database.ServerValue.TIMESTAMP
      });
      input.value = '';
    }

    // ============================================
    //  ÉVÉNEMENTS (création, participation)
    // ============================================
    document.getElementById('showCreateEventFormBtn').addEventListener('click', () => {
      document.getElementById('createEventForm').classList.toggle('visible');
    });
    document.getElementById('cancelCreateEvent').addEventListener('click', () => {
      document.getElementById('createEventForm').classList.remove('visible');
    });

    document.getElementById('submitCreateEvent').addEventListener('click', async () => {
      if (!currentUser) return alert('Connectez-vous d\'abord.');
      const title = document.getElementById('eventTitleInput').value.trim();
      const day = document.getElementById('eventDayInput').value.trim();
      const month = document.getElementById('eventMonthInput').value.trim();
      const time = document.getElementById('eventTimeInput').value.trim();
      if (!title || !day || !month || !time) return alert('Tous les champs sont requis');
      
      const newEventRef = db.ref('community/events').push();
      await newEventRef.set({
        title: title,
        day: day,
        month: month,
        time: time,
        creatorId: currentUser.uid,
        participants: {},
        createdAt: firebase.database.ServerValue.TIMESTAMP
      });
      
      document.getElementById('eventTitleInput').value = '';
      document.getElementById('eventDayInput').value = '';
      document.getElementById('eventMonthInput').value = '';
      document.getElementById('eventTimeInput').value = '';
      document.getElementById('createEventForm').classList.remove('visible');
    });

    db.ref('community/events').on('value', (snapshot) => {
      const events = [];
      snapshot.forEach(child => {
        events.push({ id: child.key, ...child.val() });
      });
      renderEvents(events);
    });

    function renderEvents(events) {
      document.getElementById('eventsGrid').innerHTML = events.map(e => {
        const participantsCount = e.participants ? Object.keys(e.participants).length : 0;
        const isJoined = currentUser && e.participants && e.participants[currentUser.uid];
        return `
        <div class="event-card" data-event-id="${e.id}">
          <div class="event-date">
            <div class="event-day">${e.day}</div>
            <div class="event-month">${e.month}</div>
          </div>
          <div class="event-details">
            <h4>${escapeHtml(e.title)}</h4>
            <div class="event-meta">
              <span><i class="far fa-clock"></i> ${e.time}</span>
              <span><i class="fas fa-user"></i> ${participantsCount} inscrit${participantsCount > 1 ? 's' : ''}</span>
            </div>
            ${currentUser ? `<button class="join-event-btn ${isJoined ? 'joined-event' : ''}" data-event-id="${e.id}">${isJoined ? '✓ Inscrit' : 'Rejoindre'}</button>` : ''}
          </div>
        </div>
      `}).join('');
      attachEventListeners();
    }

    function attachEventListeners() {
      document.querySelectorAll('.join-event-btn').forEach(btn => {
        btn.removeEventListener('click', handleJoinEvent);
        btn.addEventListener('click', handleJoinEvent);
      });
    }

    async function handleJoinEvent(e) {
      if (!currentUser) return;
      const eventId = this.dataset.eventId;
      const participantRef = db.ref(`community/events/${eventId}/participants/${currentUser.uid}`);
      const snapshot = await participantRef.once('value');
      if (snapshot.val()) {
        await participantRef.remove();
      } else {
        await participantRef.set(true);
      }
    }

    // ============================================
    //  CHAT GLOBAL
    // ============================================
    db.ref('community/chat').orderByChild('timestamp').limitToLast(50).on('value', (snapshot) => {
      const msgs = [];
      snapshot.forEach(child => msgs.push({ id: child.key, ...child.val() }));
      msgs.sort((a, b) => (a.timestamp || 0) - (b.timestamp || 0));
      document.getElementById('chatMessages').innerHTML = msgs.map(m => `
        <div class="chat-message">
          <div class="chat-message-avatar">${m.userName ? m.userName.charAt(0) : 'A'}</div>
          <div class="chat-message-content">
            <div class="chat-message-author">${m.userName || 'Anonyme'}</div>
            <div class="chat-message-text">${escapeHtml(m.text)}</div>
          </div>
        </div>
      `).join('');
      document.getElementById('chatMessages').scrollTop = document.getElementById('chatMessages').scrollHeight;
    });

    document.getElementById('chatSendBtn').addEventListener('click', async () => {
      const input = document.getElementById('chatInput');
      const text = input.value.trim();
      if (!text || !currentUser) return;
      await db.ref('community/chat').push({
        userId: currentUser.uid,
        userName: currentUserName,
        text: text,
        timestamp: firebase.database.ServerValue.TIMESTAMP
      });
      input.value = '';
    });
    document.getElementById('chatInput').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') document.getElementById('chatSendBtn').click();
    });

    // ============================================
    //  TÉMOIGNAGES
    // ============================================
    db.ref('community/testimonials').on('value', (snapshot) => {
      const testimonials = [];
      snapshot.forEach(child => testimonials.push(child.val()));
      document.getElementById('testimonialsSlider').innerHTML = testimonials.map(t => `
        <div class="testimonial-card">
          <div class="testimonial-text">“${t.text}”</div>
          <div class="testimonial-author">
            <div class="testimonial-avatar" style="background: linear-gradient(145deg, var(--primary-color), var(--secondary-color));">${t.author.charAt(0)}</div>
            <div>
              <div class="testimonial-name">${t.author}</div>
              <div class="testimonial-role">${t.role}</div>
            </div>
          </div>
        </div>
      `).join('');
    });

    // ============================================
    //  UTILITAIRES
    // ============================================
    function formatTime(timestamp) {
      if (!timestamp) return 'récent';
      const date = new Date(timestamp);
      const now = new Date();
      const diffMs = now - date;
      const diffMins = Math.floor(diffMs / 60000);
      if (diffMins < 1) return 'à l\'instant';
      if (diffMins < 60) return `il y a ${diffMins} min`;
      if (diffMins < 1440) return `il y a ${Math.floor(diffMins / 60)} h`;
      return `il y a ${Math.floor(diffMins / 1440)} j`;
    }
    function escapeHtml(unsafe) {
      if (!unsafe) return '';
      return unsafe
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }
  </script>
</body>
</html>