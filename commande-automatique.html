<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Commandes Automatiques ‚Äì Social Boost Horizon</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Montserrat:wght@600;700;800&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" />

  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

  <style>
    :root {
      --auto-dark-bg: #0A162B;
      --auto-gradient-start: #1a0a2e;
      --auto-gradient-end: #16213e;
      --auto-primary: #8B5CF6;
      --auto-primary-hover: #7C3AED;
      --auto-secondary: #06B6D4;
      --auto-accent: #F59E0B;
      --auto-success: #10B981;
      --auto-error: #EF4444;
      --auto-card-bg: rgba(26, 10, 46, 0.7);
      --auto-card-border: rgba(139, 92, 246, 0.3);
      --auto-text-white: #FFFFFF;
      --auto-text-light: rgba(255, 255, 255, 0.85);
      --auto-text-muted: rgba(255, 255, 255, 0.6);
      --sbh-text-green: #4CAF50;
      --font: 'Roboto', sans-serif;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: var(--font);
      color: var(--auto-text-white);
      background: var(--auto-dark-bg);
      min-height: 100vh;
      overflow-x: hidden;
    }

    .background-animation {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      background: linear-gradient(135deg, var(--auto-gradient-start), var(--auto-gradient-end));
      overflow: hidden;
    }

    .background-animation::before {
      content: "";
      position: absolute;
      width: 500px;
      height: 500px;
      background: radial-gradient(circle, rgba(139, 92, 246, 0.15), transparent 70%);
      top: -150px;
      right: -150px;
      animation: float 15s ease-in-out infinite;
    }

    .background-animation::after {
      content: "";
      position: absolute;
      width: 400px;
      height: 400px;
      background: radial-gradient(circle, rgba(6, 182, 212, 0.12), transparent 70%);
      bottom: -100px;
      left: -100px;
      animation: float 20s ease-in-out infinite reverse;
    }

    @keyframes float {
      0%, 100% { transform: translate(0, 0) rotate(0deg); }
      50% { transform: translate(30px, -30px) rotate(180deg); }
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 20px;
      background: rgba(10, 22, 43, 0.95);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--auto-card-border);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .logo-text {
      display: flex;
      flex-direction: column;
      font-family: 'Poppins', sans-serif;
      text-decoration: none;
      line-height: 1.2;
    }

    .logo-text .text-social,
    .logo-text .text-horizon {
      color: var(--auto-text-white);
      font-size: 1.1rem;
      font-weight: 600;
    }

    .logo-text .boost-line {
      display: flex;
      align-items: center;
      color: var(--sbh-text-green);
      font-size: 1.5rem;
      font-weight: 800;
    }

    .logo-text .boost-line img {
      height: 1.5rem;
      margin-right: 0.4rem;
      animation: pulse 2s infinite;
      border-radius: 4px;
    }

    .header-icons {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .balance-display {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
      background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(6, 182, 212, 0.2));
      border: 1px solid var(--auto-card-border);
      border-radius: 25px;
      font-size: 0.9rem;
    }

    .balance-display i {
      color: var(--auto-accent);
    }

    .balance-amount {
      font-weight: 600;
      color: var(--auto-accent);
    }

    .nav-btn {
      padding: 8px 16px;
      background: transparent;
      border: 1px solid var(--auto-card-border);
      color: var(--auto-text-light);
      text-decoration: none;
      border-radius: 8px;
      font-size: 0.85rem;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .nav-btn:hover {
      background: var(--auto-primary);
      border-color: var(--auto-primary);
      color: white;
    }

    .snap-avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--auto-primary), var(--auto-secondary));
      display: flex;
      align-items: center;
      justify-content: center;
      text-decoration: none;
      font-size: 1.1rem;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }

    .page-title {
      text-align: center;
      margin-bottom: 30px;
    }

    .page-title h1 {
      font-family: 'Montserrat', sans-serif;
      font-size: 2rem;
      background: linear-gradient(135deg, var(--auto-primary), var(--auto-secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 10px;
    }

    .page-title p {
      color: var(--auto-text-muted);
      font-size: 1rem;
    }

    .platform-filter {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 12px;
      padding: 20px;
      background: var(--auto-card-bg);
      border-radius: 16px;
      border: 1px solid var(--auto-card-border);
      margin-bottom: 25px;
    }

    .platform-btn {
      width: 55px;
      height: 55px;
      border-radius: 50%;
      border: 2px solid transparent;
      background: rgba(255, 255, 255, 0.1);
      color: var(--auto-text-light);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 1.4rem;
    }

    .platform-btn:hover {
      transform: scale(1.1);
    }

    .platform-btn.active {
      transform: scale(1.15);
      box-shadow: 0 0 20px rgba(139, 92, 246, 0.5);
    }

    .platform-btn.all-btn { background: linear-gradient(135deg, var(--auto-primary), var(--auto-secondary)); color: white; font-size: 0.8rem; font-weight: 600; }
    .platform-btn.all-btn.active { border-color: white; }

    .platform-btn[data-platform="facebook"] { background: #1877F2; color: white; }
    .platform-btn[data-platform="facebook"].active { border-color: #1877F2; box-shadow: 0 0 20px rgba(24, 119, 242, 0.6); }

    .platform-btn[data-platform="instagram"] { background: linear-gradient(45deg, #f09433, #e6683c, #dc2743, #cc2366, #bc1888); color: white; }
    .platform-btn[data-platform="instagram"].active { border-color: #E4405F; box-shadow: 0 0 20px rgba(228, 64, 95, 0.6); }

    .platform-btn[data-platform="tiktok"] { background: #000000; color: white; }
    .platform-btn[data-platform="tiktok"].active { border-color: #69C9D0; box-shadow: 0 0 20px rgba(105, 201, 208, 0.6); }

    .platform-btn[data-platform="youtube"] { background: #FF0000; color: white; }
    .platform-btn[data-platform="youtube"].active { border-color: #FF0000; box-shadow: 0 0 20px rgba(255, 0, 0, 0.6); }

    .platform-btn[data-platform="twitter"] { background: #000000; color: white; }
    .platform-btn[data-platform="twitter"].active { border-color: #1DA1F2; box-shadow: 0 0 20px rgba(29, 161, 242, 0.6); }

    .platform-btn[data-platform="telegram"] { background: #0088CC; color: white; }
    .platform-btn[data-platform="telegram"].active { border-color: #0088CC; box-shadow: 0 0 20px rgba(0, 136, 204, 0.6); }

    .platform-btn[data-platform="linkedin"] { background: #0A66C2; color: white; }
    .platform-btn[data-platform="linkedin"].active { border-color: #0A66C2; box-shadow: 0 0 20px rgba(10, 102, 194, 0.6); }

    .platform-btn[data-platform="spotify"] { background: #1DB954; color: white; }
    .platform-btn[data-platform="spotify"].active { border-color: #1DB954; box-shadow: 0 0 20px rgba(29, 185, 84, 0.6); }

    .platform-btn[data-platform="twitch"] { background: #9146FF; color: white; }
    .platform-btn[data-platform="twitch"].active { border-color: #9146FF; box-shadow: 0 0 20px rgba(145, 70, 255, 0.6); }

    .platform-btn[data-platform="discord"] { background: #5865F2; color: white; }
    .platform-btn[data-platform="discord"].active { border-color: #5865F2; box-shadow: 0 0 20px rgba(88, 101, 242, 0.6); }

    .search-section {
      background: var(--auto-card-bg);
      border-radius: 16px;
      border: 1px solid var(--auto-card-border);
      padding: 20px;
      margin-bottom: 25px;
    }

    .search-box {
      display: flex;
      align-items: center;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 12px 20px;
      gap: 12px;
    }

    .search-box i {
      color: var(--auto-text-muted);
      font-size: 1.2rem;
    }

    .search-box input {
      flex: 1;
      background: transparent;
      border: none;
      color: var(--auto-text-white);
      font-size: 1rem;
      outline: none;
    }

    .search-box input::placeholder {
      color: var(--auto-text-muted);
    }

    .services-count {
      text-align: center;
      margin-top: 15px;
      color: var(--auto-text-muted);
      font-size: 0.9rem;
    }

    .category-tabs {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 25px;
      justify-content: center;
    }

    .category-tab {
      padding: 10px 20px;
      background: var(--auto-card-bg);
      border: 1px solid var(--auto-card-border);
      border-radius: 25px;
      color: var(--auto-text-light);
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .category-tab:hover {
      background: rgba(139, 92, 246, 0.2);
      border-color: var(--auto-primary);
    }

    .category-tab.active {
      background: var(--auto-primary);
      border-color: var(--auto-primary);
      color: white;
    }

    .category-tab .count {
      background: rgba(255, 255, 255, 0.2);
      padding: 2px 8px;
      border-radius: 10px;
      font-size: 0.8rem;
    }

    .services-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 20px;
    }

    .service-card {
      background: var(--auto-card-bg);
      border: 1px solid var(--auto-card-border);
      border-radius: 16px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .service-card:hover {
      transform: translateY(-5px);
      border-color: var(--auto-primary);
      box-shadow: 0 10px 30px rgba(139, 92, 246, 0.3);
    }

    .service-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 15px;
    }

    .service-id {
      background: rgba(139, 92, 246, 0.2);
      color: var(--auto-primary);
      padding: 4px 10px;
      border-radius: 6px;
      font-size: 0.75rem;
      font-weight: 600;
    }

    .service-badges {
      display: flex;
      gap: 6px;
    }

    .badge {
      padding: 3px 8px;
      border-radius: 4px;
      font-size: 0.7rem;
      font-weight: 600;
    }

    .badge-refill {
      background: rgba(16, 185, 129, 0.2);
      color: var(--auto-success);
    }

    .badge-cancel {
      background: rgba(239, 68, 68, 0.2);
      color: var(--auto-error);
    }

    .service-name {
      font-size: 1rem;
      font-weight: 500;
      color: var(--auto-text-white);
      margin-bottom: 12px;
      line-height: 1.4;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .service-details {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding: 10px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
    }

    .service-quantity {
      color: var(--auto-text-muted);
      font-size: 0.85rem;
    }

    .service-price {
      font-size: 1.2rem;
      font-weight: 700;
      color: var(--auto-accent);
    }

    .service-price small {
      font-size: 0.7rem;
      font-weight: 400;
      color: var(--auto-text-muted);
    }

    .service-category {
      color: var(--auto-secondary);
      font-size: 0.8rem;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .order-panel-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      z-index: 200;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }

    .order-panel-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    .order-panel {
      position: fixed;
      top: 0;
      right: -450px;
      width: 100%;
      max-width: 450px;
      height: 100%;
      background: linear-gradient(180deg, var(--auto-gradient-start), var(--auto-gradient-end));
      z-index: 201;
      transition: right 0.4s ease;
      overflow-y: auto;
      border-left: 1px solid var(--auto-card-border);
    }

    .order-panel.active {
      right: 0;
    }

    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px;
      border-bottom: 1px solid var(--auto-card-border);
      position: sticky;
      top: 0;
      background: var(--auto-gradient-start);
      z-index: 10;
    }

    .panel-header h2 {
      font-size: 1.3rem;
      color: var(--auto-text-white);
    }

    .close-panel {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.1);
      border: none;
      color: var(--auto-text-white);
      font-size: 1.2rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .close-panel:hover {
      background: var(--auto-error);
    }

    .panel-content {
      padding: 20px;
    }

    .selected-service {
      background: var(--auto-card-bg);
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 20px;
    }

    .selected-service-name {
      font-size: 1rem;
      margin-bottom: 10px;
      color: var(--auto-text-white);
    }

    .selected-service-info {
      display: flex;
      justify-content: space-between;
      color: var(--auto-text-muted);
      font-size: 0.85rem;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      color: var(--auto-text-light);
      font-weight: 500;
    }

    .form-group input {
      width: 100%;
      padding: 14px 16px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid var(--auto-card-border);
      border-radius: 10px;
      color: var(--auto-text-white);
      font-size: 1rem;
      outline: none;
      transition: all 0.3s ease;
    }

    .form-group input:focus {
      border-color: var(--auto-primary);
      background: rgba(139, 92, 246, 0.1);
    }

    .form-group input::placeholder {
      color: var(--auto-text-muted);
    }

    .price-summary {
      background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(6, 182, 212, 0.2));
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
    }

    .price-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
      color: var(--auto-text-light);
    }

    .price-row.total {
      border-top: 1px solid var(--auto-card-border);
      padding-top: 10px;
      margin-top: 10px;
      font-size: 1.2rem;
      font-weight: 700;
    }

    .price-row.total span:last-child {
      color: var(--auto-accent);
    }

    .submit-btn {
      width: 100%;
      padding: 16px;
      background: linear-gradient(135deg, var(--auto-primary), var(--auto-secondary));
      border: none;
      border-radius: 12px;
      color: white;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .submit-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(139, 92, 246, 0.4);
    }

    .submit-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .submit-btn.loading {
      pointer-events: none;
    }

    .submit-btn.loading::after {
      content: "";
      width: 20px;
      height: 20px;
      border: 2px solid white;
      border-top-color: transparent;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 25px;
      border-radius: 10px;
      color: white;
      font-weight: 500;
      z-index: 300;
      transform: translateX(120%);
      transition: transform 0.4s ease;
      max-width: 350px;
    }

    .notification.show {
      transform: translateX(0);
    }

    .notification.success {
      background: linear-gradient(135deg, #10B981, #059669);
    }

    .notification.error {
      background: linear-gradient(135deg, #EF4444, #DC2626);
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--auto-text-muted);
    }

    .empty-state i {
      font-size: 4rem;
      margin-bottom: 20px;
      opacity: 0.5;
    }

    .empty-state h3 {
      font-size: 1.3rem;
      margin-bottom: 10px;
      color: var(--auto-text-light);
    }

    .loading-skeleton {
      background: linear-gradient(90deg, rgba(255,255,255,0.05) 25%, rgba(255,255,255,0.1) 50%, rgba(255,255,255,0.05) 75%);
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
      border-radius: 12px;
    }

    @keyframes shimmer {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }

    @media (max-width: 768px) {
      header {
        padding: 10px 15px;
        flex-wrap: wrap;
        gap: 10px;
      }

      .header-icons {
        gap: 10px;
      }

      .nav-btn {
        padding: 6px 10px;
        font-size: 0.75rem;
      }

      .nav-btn span {
        display: none;
      }

      .balance-display {
        padding: 6px 12px;
        font-size: 0.8rem;
      }

      .page-title h1 {
        font-size: 1.5rem;
      }

      .platform-btn {
        width: 45px;
        height: 45px;
        font-size: 1.1rem;
      }

      .services-grid {
        grid-template-columns: 1fr;
      }

      .order-panel {
        max-width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="background-animation"></div>

  <header data-aos="fade-down">
    <a href="dashboard.html" class="logo-text">
      <span class="text-social">SOCIAL</span>
      <div class="boost-line">
        <img src="https://raw.githubusercontent.com/exaucenapopolo/Social-Boost-Horizon-/refs/heads/main/assets/logos/Logo%20social%20Boost%20horizon.jpg" alt="Logo">
        <span class="text-boost">BOOST</span>
      </div>
      <span class="text-horizon">HORIZON</span>
    </a>
    <div class="header-icons">
      <div class="balance-display">
        <i class="fas fa-coins"></i>
        <span class="balance-amount" id="userBalance">0 FCFA</span>
      </div>
      <a href="mes-commandes-auto.html" class="nav-btn">
        <i class="fas fa-history"></i>
        <span>Historique</span>
      </a>
      <a href="dashboard.html" class="nav-btn">
        <i class="fas fa-home"></i>
        <span>Accueil</span>
      </a>
      <a href="profil.html" class="snap-avatar">üë§</a>
    </div>
  </header>

  <div class="container">
    <div class="page-title" data-aos="fade-up">
      <h1><i class="fas fa-bolt"></i> Commandes Automatiques</h1>
      <p>Services 100% automatis√©s - Livraison instantan√©e 24h/24</p>
    </div>

    <div class="platform-filter" id="platformFilter" data-aos="fade-up">
      <div class="platform-btn all-btn active" data-platform="" title="Tous">Tous</div>
      <div class="platform-btn" data-platform="facebook" title="Facebook"><i class="fab fa-facebook-f"></i></div>
      <div class="platform-btn" data-platform="instagram" title="Instagram"><i class="fab fa-instagram"></i></div>
      <div class="platform-btn" data-platform="tiktok" title="TikTok"><i class="fab fa-tiktok"></i></div>
      <div class="platform-btn" data-platform="youtube" title="YouTube"><i class="fab fa-youtube"></i></div>
      <div class="platform-btn" data-platform="twitter" title="Twitter / X"><i class="fab fa-twitter"></i></div>
      <div class="platform-btn" data-platform="telegram" title="Telegram"><i class="fab fa-telegram-plane"></i></div>
      <div class="platform-btn" data-platform="linkedin" title="LinkedIn"><i class="fab fa-linkedin-in"></i></div>
      <div class="platform-btn" data-platform="spotify" title="Spotify"><i class="fab fa-spotify"></i></div>
      <div class="platform-btn" data-platform="twitch" title="Twitch"><i class="fab fa-twitch"></i></div>
      <div class="platform-btn" data-platform="discord" title="Discord"><i class="fab fa-discord"></i></div>
    </div>

    <div class="search-section" data-aos="fade-up">
      <div class="search-box">
        <i class="fas fa-search"></i>
        <input type="text" id="searchServices" placeholder="Rechercher un service (ex: vues TikTok, abonn√©s Instagram...)">
      </div>
      <div class="services-count" id="servicesCount">Chargement des services...</div>
    </div>

    <div class="category-tabs" id="categoryTabs" data-aos="fade-up"></div>

    <div class="services-grid" id="servicesGrid">
      <div class="loading-skeleton" style="height: 200px;"></div>
      <div class="loading-skeleton" style="height: 200px;"></div>
      <div class="loading-skeleton" style="height: 200px;"></div>
    </div>
  </div>

  <div class="order-panel-overlay" id="orderPanelOverlay"></div>
  <div class="order-panel" id="orderPanel">
    <div class="panel-header">
      <h2><i class="fas fa-shopping-cart"></i> Nouvelle Commande</h2>
      <button class="close-panel" id="closePanel"><i class="fas fa-times"></i></button>
    </div>
    <div class="panel-content">
      <div class="selected-service" id="selectedServiceInfo">
        <div class="selected-service-name" id="panelServiceName">-</div>
        <div class="selected-service-info">
          <span id="panelServiceMin">Min: -</span>
          <span id="panelServiceMax">Max: -</span>
        </div>
      </div>

      <form id="orderForm">
        <div class="form-group">
          <label for="orderLink"><i class="fas fa-link"></i> Lien de la publication</label>
          <input type="url" id="orderLink" placeholder="https://..." required>
        </div>

        <div class="form-group">
          <label for="orderQuantity"><i class="fas fa-sort-numeric-up"></i> Quantit√©</label>
          <input type="number" id="orderQuantity" placeholder="Entrez la quantit√©" required>
        </div>

        <div class="price-summary">
          <div class="price-row">
            <span>Prix unitaire (1000)</span>
            <span id="unitPrice">0 FCFA</span>
          </div>
          <div class="price-row">
            <span>Quantit√©</span>
            <span id="displayQuantity">0</span>
          </div>
          <div class="price-row total">
            <span>Total</span>
            <span id="totalPrice">0 FCFA</span>
          </div>
        </div>

        <button type="submit" class="submit-btn" id="submitBtn">
          <i class="fas fa-bolt"></i> Commander Maintenant
        </button>
      </form>
    </div>
  </div>

  <div class="notification" id="notification"></div>

  <script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
  <script>
    AOS.init({ duration: 600, once: true });

    const firebaseConfig = {
      apiKey: "AIzaSyB6h9qKlBOF6vFTFPP1JhPnT_lObXqNwdw",
      authDomain: "social-boost-horizon.firebaseapp.com",
      projectId: "social-boost-horizon",
      storageBucket: "social-boost-horizon.firebasestorage.app",
      messagingSenderId: "43658165639",
      appId: "1:43658165639:web:0f8a9d95d9b6b1a8f4e9c8"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    const BACKEND_URL = window.location.hostname === 'localhost' || window.location.hostname.includes('replit')
      ? ''
      : 'https://social-boost-exaucenapopolo2.replit.app';

    let allServices = [];
    let selectedPlatform = null;
    let selectedCategory = null;
    let selectedService = null;
    let userBalance = 0;
    let userId = null;

    const platformFilter = document.getElementById('platformFilter');
    const categoryTabs = document.getElementById('categoryTabs');
    const servicesGrid = document.getElementById('servicesGrid');
    const searchServices = document.getElementById('searchServices');
    const servicesCount = document.getElementById('servicesCount');
    const userBalanceEl = document.getElementById('userBalance');
    const orderPanel = document.getElementById('orderPanel');
    const orderPanelOverlay = document.getElementById('orderPanelOverlay');
    const closePanel = document.getElementById('closePanel');
    const orderForm = document.getElementById('orderForm');
    const orderLink = document.getElementById('orderLink');
    const orderQuantity = document.getElementById('orderQuantity');
    const unitPrice = document.getElementById('unitPrice');
    const displayQuantity = document.getElementById('displayQuantity');
    const totalPrice = document.getElementById('totalPrice');
    const submitBtn = document.getElementById('submitBtn');
    const panelServiceName = document.getElementById('panelServiceName');
    const panelServiceMin = document.getElementById('panelServiceMin');
    const panelServiceMax = document.getElementById('panelServiceMax');
    const notification = document.getElementById('notification');

    function formatPrice(amount) {
      return new Intl.NumberFormat('fr-FR').format(Math.round(amount)) + ' FCFA';
    }

    function notify(message, type = 'success') {
      notification.textContent = message;
      notification.className = `notification ${type} show`;
      setTimeout(() => notification.classList.remove('show'), 4000);
    }

    function translateServiceName(name) {
      const translations = {
        'Views': 'Vues',
        'Likes': 'J\'aime',
        'Followers': 'Abonn√©s',
        'Subscribers': 'Abonn√©s',
        'Comments': 'Commentaires',
        'Shares': 'Partages',
        'Saves': 'Sauvegardes',
        'Reactions': 'R√©actions',
        'Video Views': 'Vues Vid√©o',
        'Post': 'Publication',
        'Reel': 'Reel',
        'Story': 'Story',
        'Live': 'Live',
        'Watch Time': 'Temps de visionnage',
        'Hours': 'Heures',
        'Minutes': 'Minutes',
        'Real': 'R√©el',
        'High Quality': 'Haute Qualit√©',
        'Premium': 'Premium',
        'Instant': 'Instantan√©',
        'Fast': 'Rapide',
        'Slow': 'Lent',
        'Speed': 'Vitesse',
        'Day': 'Jour',
        'Refill': 'Recharge',
        'No Refill': 'Sans Recharge',
        'Lifetime': '√Ä vie',
        'Guaranteed': 'Garanti',
        'Max': 'Max',
        'Min': 'Min',
        'NEW': 'NOUVEAU',
        'Global': 'Mondial',
        'USA': '√âtats-Unis',
        'UK': 'Royaume-Uni',
        'Tweet': 'Tweet',
        'Retweets': 'Retweets',
        'Impressions': 'Impressions',
        'Profile Visits': 'Visites de Profil',
        'Engagements': 'Engagements',
        'Members': 'Membres',
        'Channel': 'Cha√Æne',
        'Group': 'Groupe'
      };

      let translated = name;
      for (const [en, fr] of Object.entries(translations)) {
        translated = translated.replace(new RegExp(en, 'gi'), fr);
      }
      return translated;
    }

    function detectPlatform(service) {
      const name = (service.name || '').toLowerCase();
      const category = (service.category || '').toLowerCase();
      const text = name + ' ' + category;

      if (text.includes('instagram') || text.includes('ig ') || text.includes('insta')) return 'instagram';
      if (text.includes('facebook') || text.includes('fb ')) return 'facebook';
      if (text.includes('tiktok') || text.includes('tik tok')) return 'tiktok';
      if (text.includes('youtube') || text.includes('yt ')) return 'youtube';
      if (text.includes('twitter') || text.includes('x/twitter') || text.includes('tweet')) return 'twitter';
      if (text.includes('telegram') || text.includes('tg ')) return 'telegram';
      if (text.includes('linkedin')) return 'linkedin';
      if (text.includes('spotify')) return 'spotify';
      if (text.includes('twitch')) return 'twitch';
      if (text.includes('discord')) return 'discord';
      return 'other';
    }

    function detectServiceType(name) {
      const n = name.toLowerCase();
      if (n.includes('view') || n.includes('vue')) return 'Vues';
      if (n.includes('like') || n.includes('j\'aime')) return 'J\'aime';
      if (n.includes('follower') || n.includes('subscriber') || n.includes('abonn√©')) return 'Abonn√©s';
      if (n.includes('comment') || n.includes('commentaire')) return 'Commentaires';
      if (n.includes('share') || n.includes('partage')) return 'Partages';
      if (n.includes('save') || n.includes('sauvegarde')) return 'Sauvegardes';
      if (n.includes('reaction') || n.includes('r√©action')) return 'R√©actions';
      if (n.includes('retweet')) return 'Retweets';
      if (n.includes('member') || n.includes('membre')) return 'Membres';
      return 'Autres';
    }

    async function loadServices() {
      try {
        const response = await fetch(`${BACKEND_URL}/api/mtp/services`);
        const data = await response.json();

        if (!data.success) {
          throw new Error(data.error || 'Erreur de chargement');
        }

        allServices = data.services.map(s => ({
          ...s,
          platform: detectPlatform(s),
          serviceType: detectServiceType(s.name),
          translatedName: translateServiceName(s.name)
        }));

        renderCategories();
        filterAndRenderServices();
      } catch (error) {
        console.error('Erreur chargement services:', error);
        servicesGrid.innerHTML = `
          <div class="empty-state">
            <i class="fas fa-exclamation-triangle"></i>
            <h3>Erreur de chargement</h3>
            <p>${error.message}</p>
          </div>
        `;
      }
    }

    function renderCategories() {
      let filtered = allServices;

      if (selectedPlatform) {
        filtered = allServices.filter(s => s.platform === selectedPlatform);
      }

      const categories = {};
      filtered.forEach(s => {
        const type = s.serviceType;
        if (!categories[type]) categories[type] = 0;
        categories[type]++;
      });

      const sortedCategories = Object.entries(categories).sort((a, b) => b[1] - a[1]);

      categoryTabs.innerHTML = `
        <div class="category-tab ${!selectedCategory ? 'active' : ''}" data-category="">
          Tous <span class="count">${filtered.length}</span>
        </div>
        ${sortedCategories.map(([cat, count]) => `
          <div class="category-tab ${selectedCategory === cat ? 'active' : ''}" data-category="${cat}">
            ${cat} <span class="count">${count}</span>
          </div>
        `).join('')}
      `;

      categoryTabs.querySelectorAll('.category-tab').forEach(tab => {
        tab.addEventListener('click', () => {
          selectedCategory = tab.dataset.category || null;
          renderCategories();
          filterAndRenderServices();
        });
      });
    }

    function filterAndRenderServices() {
      const searchTerm = searchServices.value.toLowerCase();
      let filtered = allServices;

      if (selectedPlatform) {
        filtered = filtered.filter(s => s.platform === selectedPlatform);
      }

      if (selectedCategory) {
        filtered = filtered.filter(s => s.serviceType === selectedCategory);
      }

      if (searchTerm) {
        filtered = filtered.filter(s =>
          s.name.toLowerCase().includes(searchTerm) ||
          s.translatedName.toLowerCase().includes(searchTerm) ||
          s.category.toLowerCase().includes(searchTerm)
        );
      }

      renderServices(filtered);
      servicesCount.textContent = `${filtered.length} service${filtered.length > 1 ? 's' : ''} disponible${filtered.length > 1 ? 's' : ''}`;
    }

    function renderServices(services) {
      if (services.length === 0) {
        servicesGrid.innerHTML = `
          <div class="empty-state">
            <i class="fas fa-search"></i>
            <h3>Aucun service trouv√©</h3>
            <p>Essayez de modifier vos filtres</p>
          </div>
        `;
        return;
      }

      servicesGrid.innerHTML = services.map(service => `
        <div class="service-card" data-id="${service.id}">
          <div class="service-header">
            <span class="service-id">#${service.id}</span>
            <div class="service-badges">
              ${service.refill ? '<span class="badge badge-refill">Recharge</span>' : ''}
              ${service.cancel ? '<span class="badge badge-cancel">Annulable</span>' : ''}
            </div>
          </div>
          <div class="service-name">${service.translatedName}</div>
          <div class="service-details">
            <span class="service-quantity">
              <i class="fas fa-layer-group"></i> ${service.min.toLocaleString()} - ${service.max.toLocaleString()}
            </span>
            <span class="service-price">
              ${formatPrice(service.priceXAF)} <small>/1000</small>
            </span>
          </div>
          <div class="service-category">
            <i class="fas fa-tag"></i> ${service.serviceType}
          </div>
        </div>
      `).join('');

      servicesGrid.querySelectorAll('.service-card').forEach(card => {
        card.addEventListener('click', () => {
          const serviceId = parseInt(card.dataset.id);
          selectedService = allServices.find(s => s.id === serviceId);
          if (selectedService) openOrderPanel();
        });
      });
    }

    platformFilter.querySelectorAll('.platform-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        platformFilter.querySelectorAll('.platform-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        selectedPlatform = btn.dataset.platform || null;
        selectedCategory = null;
        renderCategories();
        filterAndRenderServices();
      });
    });

    searchServices.addEventListener('input', filterAndRenderServices);

    function openOrderPanel() {
      if (!selectedService) return;

      panelServiceName.textContent = selectedService.translatedName;
      panelServiceMin.textContent = `Min: ${selectedService.min.toLocaleString()}`;
      panelServiceMax.textContent = `Max: ${selectedService.max.toLocaleString()}`;
      unitPrice.textContent = formatPrice(selectedService.priceXAF);

      orderQuantity.min = selectedService.min;
      orderQuantity.max = selectedService.max;
      orderQuantity.value = '';
      orderLink.value = '';
      displayQuantity.textContent = '0';
      totalPrice.textContent = '0 FCFA';

      orderPanel.classList.add('active');
      orderPanelOverlay.classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    function closeOrderPanel() {
      orderPanel.classList.remove('active');
      orderPanelOverlay.classList.remove('active');
      document.body.style.overflow = '';
    }

    closePanel.addEventListener('click', closeOrderPanel);
    orderPanelOverlay.addEventListener('click', closeOrderPanel);

    orderQuantity.addEventListener('input', () => {
      const qty = parseInt(orderQuantity.value) || 0;
      displayQuantity.textContent = qty.toLocaleString();
      if (selectedService) {
        const total = Math.round((selectedService.priceXAF / 1000) * qty);
        totalPrice.textContent = formatPrice(total);
      }
    });

    orderForm.addEventListener('submit', async (e) => {
      e.preventDefault();

      if (!selectedService || !userId) {
        notify('Erreur: Service ou utilisateur non s√©lectionn√©', 'error');
        return;
      }

      const link = orderLink.value.trim();
      const quantity = parseInt(orderQuantity.value);

      if (!link.startsWith('http://') && !link.startsWith('https://')) {
        notify('Le lien doit commencer par http:// ou https://', 'error');
        return;
      }

      if (quantity < selectedService.min || quantity > selectedService.max) {
        notify(`Quantit√© invalide. Min: ${selectedService.min}, Max: ${selectedService.max}`, 'error');
        return;
      }

      const total = Math.round((selectedService.priceXAF / 1000) * quantity);
      if (total > userBalance) {
        notify(`Solde insuffisant. Requis: ${formatPrice(total)}`, 'error');
        return;
      }

      submitBtn.disabled = true;
      submitBtn.classList.add('loading');
      submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Traitement...';

      try {
        const idToken = await auth.currentUser.getIdToken();
        const response = await fetch(`${BACKEND_URL}/api/mtp/order`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${idToken}`
          },
          body: JSON.stringify({
            serviceId: selectedService.id,
            link: link,
            quantity: quantity
          })
        });

        const data = await response.json();

        if (!data.success) {
          throw new Error(data.error || 'Erreur lors de la commande');
        }

        notify(`Commande #${data.orderId} pass√©e avec succ√®s !`, 'success');
        userBalance = data.newBalance;
        userBalanceEl.textContent = formatPrice(userBalance);
        closeOrderPanel();
        orderForm.reset();

      } catch (error) {
        console.error('Erreur commande:', error);
        notify(error.message, 'error');
      } finally {
        submitBtn.disabled = false;
        submitBtn.classList.remove('loading');
        submitBtn.innerHTML = '<i class="fas fa-bolt"></i> Commander Maintenant';
      }
    });

    auth.onAuthStateChanged(async (user) => {
      if (user) {
        userId = user.uid;

        db.collection('users').doc(userId).onSnapshot((doc) => {
          if (doc.exists) {
            userBalance = doc.data().balance || 0;
            userBalanceEl.textContent = formatPrice(userBalance);
          }
        });

        loadServices();
      } else {
        notify('Vous devez √™tre connect√© pour acc√©der √† cette page', 'error');
        setTimeout(() => {
          window.location.href = 'login.html';
        }, 2000);
      }
    });
  </script>
</body>
</html>
